# Журнал ошибок и исправлений (Errors Runbook)

Документ для повторных проверок логов: что уже исправлено, что считать новым. При команде «посмотри ошибки в логах» — сначала читать этот файл, затем логи; реагировать только на ошибки, которых нет в списке «Исправлено».

---

## Как пользоваться

1. **Перед разбором логов** — прочитать секцию «Исправлено» ниже.
2. **Скачать/посмотреть логи** (ssh runterra, journalctl, error-*.log).
3. **Сопоставить:** если ошибка в логах совпадает с пунктом из «Исправлено» — не предлагать правку заново (возможно старый лог или деплой не обновлён).
4. **Новые ошибки** — те, которых нет в «Исправлено» — разбирать и исправлять, после исправления добавить их в «Исправлено» с датой.

---

## Исправлено (не предлагать повторно)

Формат: краткое описание | сигнатура в логах | что сделано | дата.

- **Пробежка с нулевой длительностью (500)**  
  Сигнатура: `"Error creating run"`, `runs_duration_positive`, `constraint`, `duration` 0.  
  Что сделано: в `backend/src/api/runs.routes.ts` добавлена проверка `duration >= 30` до вызова репозитория; при нарушении возврат 400 с сообщением «duration must be at least 30 seconds».  
  Дата: 2026-02-03.

- **Глобальные сообщения — невалидный cityId (500)**  
  Сигнатура: `"Error fetching global messages"`, `string_to_uuid`, `parameter $2 = '...'`, код 22P02.  
  Что сделано: в `backend/src/api/messages.routes.ts` для GET `/global` добавлена валидация `cityId` как UUID; при невалидном значении возврат 400 «cityId must be a valid UUID».  
  Дата: 2026-02-03.

---

## Известные открытые (не из логов backend)

- **Вылет при «Начать пробежку» в Nox** — краш на эмуляторе при старте foreground service (GPS). Решение не вводили: оставлен фоновый режим и в debug по запросу. Не бэкенд, не логи runterra.

---

## Где смотреть логи

- **Backend (runterra):**  
  - systemd: `ssh runterra "journalctl -u runterra-backend -n 500 --no-pager"`  
  - Файлы: `ssh runterra "tail -200 /home/user1/runterra/logs/error-YYYY-MM-DD.log"`  
- **Дата в имени файла** — по UTC (или по серверу). Для «сегодня» подставлять актуальную дату.

При добавлении нового пункта в «Исправлено» указывать дату и файлы/коммиты, чтобы не дублировать правки.
