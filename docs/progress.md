# Прогресс разработки

## Обзор
Документ отслеживает выполнение задач и прогресс разработки проекта Runterra.

- **Сообщения: выбор клуба перед чатом (2026-02-08):** Во вкладке «Сообщения → Клуб» первым шагом отображается список клубов пользователя (из GET /api/messages/clubs); чат открывается только после выбора клуба. Добавлена кнопка «Назад» для возврата к списку. Поддержан deep-link `/messages?tab=club&clubId=...` и переход с экрана клуба «Чат клуба» на чат именно этого клуба. Добавлены l10n: messagesBackToClubs, messagesSelectClub. Подробности — docs/changes/messages.md.
- **Профиль: экран «Мои клубы» (2026-02-08):** Реализован отдельный сценарий просмотра всех клубов пользователя. Backend: добавлен `GET /api/clubs/my` и репозиторный метод `findActiveClubsByUser()` с возвратом `id/name/cityId/cityName/status/role/joinedAt`. Добавлены API-тесты на успешный сценарий и `401` для отсутствующего пользователя. Mobile: добавлены `MyClubModel`, `ClubsService.getMyClubs()`, кнопка «Клубы» в профиле, экран `/profile/clubs` со списком клубов, состояниями loading/empty/error+retry и переходом в детали клуба. Добавлены локализации ru/en и тест модели. Подробности — docs/changes/clubs.md.
- **Организатор события — отображаемое имя (2026-02-08):** Во вкладке «Событие» вместо сырого ID организатора теперь показывается имя создателя события (название клуба или имя тренера). Backend: в DTO событий добавлено опциональное поле `organizerDisplayName`; для списков (GET /api/events, GET /api/map/data) используется батч-резолв `getOrganizerDisplayNamesBatch` (два запроса к БД вместо N); для деталей — `getOrganizerDisplayName`. В `ClubsRepository` добавлен `findByIds`. Mobile: пустая/пробельная строка `organizerDisplayName` обрабатывается как отсутствие имени (fallback на ID). Добавлены тесты API на наличие `organizerDisplayName` в ответах. Подробности — docs/changes/events.md.
- **Редактирование профиля клуба для лидера (2026-02-08):** Реализована функциональность редактирования клуба согласно product_spec.md §5.3. Backend: добавлен PATCH /api/clubs/:id с проверкой роли leader (только лидер может редактировать); создан UpdateClubDto и UpdateClubSchema с валидацией name (3-50 символов) и description (до 500 символов); обновлён GET /api/clubs/:id для возврата поля userRole ('member' | 'trainer' | 'leader' | null). Mobile: добавлено поле userRole в ClubModel; создан EditClubScreen для редактирования названия и описания с валидацией на клиенте; на ClubDetailsScreen добавлена кнопка "Редактировать клуб" (видна только лидерам); добавлена локализация en/ru. Подробности — docs/changes/clubs.md.
- **Feedback (2026-02-08) — клубы и события (исправлено):** (1) Клубы: добавлено поле role в таблицу club_members (миграция 013_club_members_role.sql) с ролями member/trainer/leader; создатель клуба теперь получает роль leader вместо member при создании; добавлен метод countActiveMembers() в ClubMembersRepository; GET /api/clubs/:id возвращает реальное количество участников из БД вместо заглушки 0; обновлены моки в тестах. (2) События: исправлен фильтр "Только открытые" — добавлено условие (end_date_time IS NULL OR end_date_time > NOW()) в фильтр по умолчанию EventsRepository.findAll(), прошедшие события (где end_date_time < NOW) теперь не возвращаются при фильтре "открытые". Все тесты проходят (77 passed). Подробности — infra/README.md.
### 2026-02-08- **Исправление архитектурных недостатков клубов (критично, P0):** Исправлены критические проблемы целостности данных и валидации clubId. (1) Добавлен Foreign Key между `club_members.club_id` и `clubs.id`: создана миграция `012_clubs_fk.sql`, которая конвертирует `club_members.club_id` из `VARCHAR(128)` в `UUID`, удаляет orphaned records и добавляет FK с каскадным удалением; убран костыль `id::text` из `ClubsRepository.findById()`. (2) Унифицирован формат clubId: валидация `isValidClubId()` изменена с slug-формата на строгий UUID; обновлены комментарии в `backend/src/shared/clubId.ts`. (3) Добавлена проверка существования клуба в `POST /api/clubs/:id/join` и `POST /api/clubs/:id/leave`: теперь перед созданием/обновлением membership вызывается `clubsRepo.findById()`, и возвращается 404 с кодом `not_found`, если клуб не найден. (4) Обновлены тесты: в `api.test.ts` slug-based ID заменены на валидные UUID-константы; добавлены моки `mockClubsRepository.findById()`. Все тесты проходят (77 passed). Недостатки задокументированы в `infra/README.md`.
## РСЃС‚РѕСЂРёСЏ РёР·РјРµРЅРµРЅРёР№

### 2026-02-07
- **Проверка логов runterra (errors-runbook):** Найдена новая ошибка уровня error, которой нет в разделе «Исправлено» runbook: Error fetching club (22P02, string_to_uuid) при GET /api/clubs/new-club-id (в логах путь как /new-club-id, параметр $1). Ошибка добавлена в docs/errors-runbook.md в «Известные открытые». По контексту связана с недавними изменениями вокруг строкового clubId: часть системы уже использует string IDs (club-1, club-2), но в этом маршруте остаётся ожидание UUID/валидация отсутствует.
### 2026-02-06
- **Mobile Messages — stale async guard:** `ClubMessagesTab` now ignores delayed polling/history responses when active `clubId` changes before the response arrives.
- **Mobile Messages вЂ” РІРєР»Р°РґРєР° В«РљР»СѓР±В» РєР°Рє СЂРµР°Р»СЊРЅС‹Р№ С‡Р°С‚ (feedback):** РСЃРїСЂР°РІР»РµРЅР° РїСЂРѕР±Р»РµРјР° В«РЅРµС‚ С‡Р°С‚Р°/РЅРµС‚ РїРѕР»СЏ РІРІРѕРґР°В» РІРѕ РІРєР»Р°РґРєРµ `РЎРѕРѕР±С‰РµРЅРёСЏ -> РљР»СѓР±`. `ClubMessagesTab` РїРµСЂРµРІРµРґС‘РЅ СЃРѕ СЃРїРёСЃРєР° РєР»СѓР±РЅС‹С… С‡Р°С‚РѕРІ РЅР° СЌРєСЂР°РЅ С‚РµРєСѓС‰РµРіРѕ РєР»СѓР±РЅРѕРіРѕ С‡Р°С‚Р°: Р·Р°РіСЂСѓР·РєР° РёСЃС‚РѕСЂРёРё С‡РµСЂРµР· `MessagesService.getClubChatMessages(clubId)` Рё РѕС‚РїСЂР°РІРєР° С‡РµСЂРµР· `MessagesService.sendClubMessage(clubId, text)`. `clubId` Р±РµСЂС‘С‚СЃСЏ РёР· `CurrentClubService.currentClubId`, Р° РїСЂРё РµРіРѕ РѕС‚СЃСѓС‚СЃС‚РІРёРё РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ fallback РЅР° РїРµСЂРІС‹Р№ РґРѕСЃС‚СѓРїРЅС‹Р№ РєР»СѓР± РёР· `getClubChats()` СЃ СЃРѕС…СЂР°РЅРµРЅРёРµРј РІ `CurrentClubService`. Р’РЅСѓС‚СЂРё С‚РµР»Р° РІРєР»Р°РґРєРё СѓР±СЂР°РЅР° РЅР°РґРїРёСЃСЊ СЃ РЅР°Р·РІР°РЅРёРµРј РєР»СѓР±Р°; РѕСЃС‚Р°РІР»РµРЅС‹ С‚РѕР»СЊРєРѕ СЃРѕРѕР±С‰РµРЅРёСЏ Рё composer. Р”РѕР±Р°РІР»РµРЅС‹ СЃРѕСЃС‚РѕСЏРЅРёСЏ loading/error/retry Рё empty-state РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РєР»СѓР±Р°. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **Mobile Messages вЂ” СЃС‚Р°Р±РёР»РёР·Р°С†РёСЏ РІРєР»Р°РґРєРё В«РљР»СѓР±В» (СЂРµРіСЂРµСЃСЃРёРё РїРѕСЃР»Рµ РїРµСЂРІРёС‡РЅРѕРіРѕ С„РёРєСЃР°):** Р—Р°РєСЂС‹С‚С‹ РїРѕС‚РµРЅС†РёР°Р»СЊРЅС‹Рµ СЂРёСЃРєРё: (1) РєРѕСЂСЂРµРєС‚РЅРѕ РѕРїСЂРµРґРµР»СЏСЋС‚СЃСЏ В«РјРѕРёВ» СЃРѕРѕР±С‰РµРЅРёСЏ РїРѕ backend `users.id` РёР· РїСЂРѕС„РёР»СЏ (СЃ fallback РЅР° Firebase uid), (2) stale `currentClubId` С‚РµРїРµСЂСЊ РІР°Р»РёРґРёСЂСѓРµС‚СЃСЏ РїРѕ С„Р°РєС‚РёС‡РµСЃРєРѕРјСѓ membership РёР· `GET /api/messages/clubs`, (3) fallback-РєР»СѓР± РІС‹Р±РёСЂР°РµС‚СЃСЏ РїРѕ `primaryClubId` РёР»Рё РїРѕ Р°РєС‚РёРІРЅРѕСЃС‚Рё, Р° РЅРµ РїРѕ В«РїРµСЂРІРѕРјСѓ РІ СЃРїРёСЃРєРµВ», (4) РґРѕР±Р°РІР»РµРЅР° РїРѕРґРіСЂСѓР·РєР° СЃС‚Р°СЂС‹С… СЃРѕРѕР±С‰РµРЅРёР№ РїСЂРё СЃРєСЂРѕР»Р»Рµ РІРІРµСЂС…, (5) РґРѕР±Р°РІР»РµРЅРѕ РїРµСЂРёРѕРґРёС‡РµСЃРєРѕРµ РѕР±РЅРѕРІР»РµРЅРёРµ РЅРѕРІС‹С… СЃРѕРѕР±С‰РµРЅРёР№ (polling), (6) РґР»СЏ РѕС€РёР±РѕРє Р·Р°РіСЂСѓР·РєРё РёСЃС‚РѕСЂРёРё РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ `messagesLoadError`, (7) Р°РІС‚РѕСЃРєСЂРѕР»Р» СЃРґРµР»Р°РЅ РїР»Р°РІРЅС‹Рј Рё РЅРµ РїРµСЂРµС…РІР°С‚С‹РІР°РµС‚ СѓРїСЂР°РІР»РµРЅРёРµ, РµСЃР»Рё РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ С‡РёС‚Р°РµС‚ РёСЃС‚РѕСЂРёСЋ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **Р Р°СЃС€РёСЂРµРЅРёРµ СЌРєСЂР°РЅР° РєР»СѓР±Р° (ClubDetailsScreen, infra/README.md):** РќР° СЌРєСЂР°РЅРµ РґРµС‚Р°Р»РµР№ РєР»СѓР±Р° РґРѕР±Р°РІР»РµРЅС‹: (1) РіРѕСЂРѕРґ РєР»СѓР±Р° вЂ” РѕС‚РѕР±СЂР°Р¶Р°РµС‚СЃСЏ РїРѕРґ РЅР°Р·РІР°РЅРёРµРј (cityName РёР· backend РёР»Рё cityId); (2) РјРµС‚СЂРёРєРё MVP вЂ” С‚СЂРё РєР°СЂС‚РѕС‡РєРё: СѓС‡Р°СЃС‚РЅРёРєРё, С‚РµСЂСЂРёС‚РѕСЂРёРё, СЂРµР№С‚РёРЅРі РІ РіРѕСЂРѕРґРµ (Р·РЅР°С‡РµРЅРёСЏ РёР· API РёР»Рё Р·Р°РіР»СѓС€РєР° В«вЂ”В»); (3) РєРЅРѕРїРєР° В«Р§Р°С‚ РєР»СѓР±Р°В» вЂ” РїРµСЂРµС…РѕРґ РЅР° СЌРєСЂР°РЅ РЎРѕРѕР±С‰РµРЅРёСЏ СЃ РѕС‚РєСЂС‹С‚РѕР№ РІРєР»Р°РґРєРѕР№ В«РљР»СѓР±В» (`/messages?tab=club`). Backend: GET `/api/clubs/:id` РґРѕРїРѕР»РЅРµРЅ РїРѕР»СЏРјРё `cityName` (РёР· РєРѕРЅС„РёРіР° РіРѕСЂРѕРґРѕРІ), `membersCount`, `territoriesCount`, `cityRank` (РїР»РµР№СЃС…РѕР»РґРµСЂС‹ 0). Mobile: ClubModel СЂР°СЃС€РёСЂРµРЅ РїРѕР»СЏРјРё cityId, cityName, membersCount, territoriesCount, cityRank; MessagesScreen РїСЂРёРЅРёРјР°РµС‚ `initialTabIndex` РґР»СЏ РѕС‚РєСЂС‹С‚РёСЏ СЃ РЅСѓР¶РЅРѕР№ РІРєР»Р°РґРєРё; РјР°СЂС€СЂСѓС‚ `/messages?tab=club` РїРµСЂРµРґР°С‘С‚ initialTabIndex: 1. i18n: clubChatButton, clubMembersLabel, clubTerritoriesLabel, clubCityRankLabel, clubMetricPlaceholder (EN/RU). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/clubs.md](changes/clubs.md).

- **РџСЂРѕРІРµСЂРєР° Р»РѕРіРѕРІ runterra (errors-runbook):** РџСЂРѕСЃРјРѕС‚СЂРµРЅС‹ journalctl Рё error-2026-02-06.log. РќРѕРІС‹С… РѕС€РёР±РѕРє РЅРµ РЅР°Р№РґРµРЅРѕ: РІ Р»РѕРіР°С… Р·Р° 06.02 С‚РѕР»СЊРєРѕ warn (POST/GET "/" в†’ 404 вЂ” РѕР¶РёРґР°РµРјРѕ). РћС€РёР±РєРё СѓСЂРѕРІРЅСЏ error РІ journalctl вЂ” РёСЃС‚РѕСЂРёС‡РµСЃРєРёРµ РѕС‚ 03.02 (global messages / string_to_uuid), СѓР¶Рµ РІ СЂР°Р·РґРµР»Рµ В«РСЃРїСЂР°РІР»РµРЅРѕВ» runbook. Р’ progress Рё runbook РґРѕР±Р°РІР»РµРЅРѕ РїСЂРёРјРµС‡Р°РЅРёРµ РїСЂРѕ РѕР¶РёРґР°РµРјС‹Рµ 404 РЅР° "/".

- **РђСѓРґРёС‚: bulk-insert GPS С‚РѕС‡РµРє (infra/README.md, 2026-02-04):** РСЃРїСЂР°РІР»РµРЅ bulk-insert GPS С‚РѕС‡РµРє РІ `RunsRepository.saveGpsPoints(runId, points)`: РїР»РµР№СЃС…РѕР»РґРµСЂС‹ С‚РµРїРµСЂСЊ СЃС‚СЂРѕСЏС‚СЃСЏ СЃ РїСЂР°РІРёР»СЊРЅС‹Рј СЃРјРµС‰РµРЅРёРµРј (`offset = index * 5` РґР»СЏ 5 СЃС‚РѕР»Р±С†РѕРІ `run_gps_points`), РїР°СЂР°РјРµС‚СЂС‹ РїРµСЂРµРґР°СЋС‚СЃСЏ РІ РїРѕСЂСЏРґРєРµ `[runId, longitude, latitude, timestamp, point_order]` РґР»СЏ РєР°Р¶РґРѕР№ С‚РѕС‡РєРё. Р”РѕР±Р°РІР»РµРЅ СЋРЅРёС‚-С‚РµСЃС‚ РІ `runs.repository.test.ts`, РєРѕС‚РѕСЂС‹Р№ РІС‹Р·С‹РІР°РµС‚ `RunsRepository.create()` СЃ РґРІСѓРјСЏ GPSвЂ‘С‚РѕС‡РєР°РјРё Рё РїСЂРѕРІРµСЂСЏРµС‚, С‡С‚Рѕ РІРѕ РІС‚РѕСЂРѕР№ DBвЂ‘Р·Р°РїСЂРѕСЃ (`INSERT INTO run_gps_points`) РїРµСЂРµРґР°С‘С‚СЃСЏ РєРѕСЂСЂРµРєС‚РЅС‹Р№ SQL Рё 10 РїР°СЂР°РјРµС‚СЂРѕРІ (2 С‚РѕС‡РєРё Г— 5 РїРѕР»РµР№) СЃ РѕР¶РёРґР°РµРјС‹РјРё Р·РЅР°С‡РµРЅРёСЏРјРё. РџСѓРЅРєС‚ Р°СѓРґРёС‚Р° РІ infra/README.md РїРѕРјРµС‡РµРЅ РєР°Рє РІС‹РїРѕР»РЅРµРЅРЅС‹Р№.
 
- **РђСѓРґРёС‚: clubId вЂ” РµРґРёРЅС‹Р№ СЃС‚СЂРѕРєРѕРІС‹Р№ С„РѕСЂРјР°С‚ РІРѕ РІСЃРµС… СЃР»РѕСЏС… (infra/README.md, 2026-02-04):** РџСЂРёРЅСЏС‚ РµРґРёРЅС‹Р№ С„РѕСЂРјР°С‚ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂР° РєР»СѓР±Р° РєР°Рє СЃС‚СЂРѕРєРѕРІС‹Р№ (opaque string) РІРѕ РІСЃРµС… СЃР»РѕСЏС…. Р’ Р‘Р” РґРѕР±Р°РІР»РµРЅР° РјРёРіСЂР°С†РёСЏ `009_messages_channel_id_varchar.sql`, РєРѕС‚РѕСЂР°СЏ РјРµРЅСЏРµС‚ С‚РёРї `messages.channel_id` СЃ `UUID` РЅР° `VARCHAR(128)`, С‡С‚РѕР±С‹ РѕРЅ СЃРѕРѕС‚РІРµС‚СЃС‚РІРѕРІР°Р» `club_members.club_id` Рё СЃС‚СЂРѕРєРѕРІС‹Рј `clubId`/`cityId` РІ РґРѕРјРµРЅРЅРѕР№ РјРѕРґРµР»Рё. Р’ WebSocket-СЃРµСЂРІРµСЂРµ (`chatWs.ts`) СЂРµРіСѓР»СЏСЂРЅРѕРµ РІС‹СЂР°Р¶РµРЅРёРµ `VALID_CHANNEL_RE` РѕСЃР»Р°Р±Р»РµРЅРѕ РґРѕ С„РѕСЂРјР°С‚Р° `club:{clubId}` СЃ РґРѕРїСѓСЃС‚РёРјС‹РјРё СЃРёРјРІРѕР»Р°РјРё `[A-Za-z0-9_-]{1,128}`, С‡С‚РѕР±С‹ РїРѕРґРґРµСЂР¶РёРІР°С‚СЊ СЃС‚СЂРѕРєРѕРІС‹Рµ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂС‹ (РЅР°РїСЂРёРјРµСЂ, `club-1`, `spb-runner-club`) РІРјРµСЃС‚Рѕ СЃС‚СЂРѕРіРѕРіРѕ UUID. РўР°РєРёРј РѕР±СЂР°Р·РѕРј, clubId/club_id/channel_id СЃРѕРіР»Р°СЃРѕРІР°РЅС‹ РєР°Рє СЃС‚СЂРѕРєРё РІ DB, API (`clubId` РІ DTO Рё РјР°СЂС€СЂСѓС‚Р°С…), WS (РєР°РЅР°Р»С‹ `club:<id>`) Рё mobile (String). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).

- **РђСѓРґРёС‚: Р°РІС‚Рѕ-СЃРѕР·РґР°РЅРёРµ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РїРѕ РІР°Р»РёРґРЅРѕРјСѓ С‚РѕРєРµРЅСѓ (infra/README.md, 2026-02-04):** Р—Р°РґР°С‡Р° РїРѕРєСЂС‹С‚Р° СЃСѓС‰РµСЃС‚РІСѓСЋС‰РµР№ СЂРµР°Р»РёР·Р°С†РёРµР№ `GET /api/users/me/profile`: РїСЂРё РїРµСЂРІРѕРј Р·Р°РїСЂРѕСЃРµ СЃ РІР°Р»РёРґРЅС‹Рј `Authorization: Bearer <token>` backend С‡РµСЂРµР· `req.authUser.uid` РёС‰РµС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РІ `UsersRepository.findByFirebaseUid`, Рё РµСЃР»Рё Р·Р°РїРёСЃСЊ РЅРµ РЅР°Р№РґРµРЅР°, Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё СЃРѕР·РґР°С‘С‚ РЅРѕРІРѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РЅР° РѕСЃРЅРѕРІРµ auth-РґР°РЅРЅС‹С… (`displayName`, `email`, `photoURL`) Рё СЃРѕС…СЂР°РЅСЏРµС‚ РµРіРѕ РІ Р‘Р” РїРµСЂРµРґ С„РѕСЂРјРёСЂРѕРІР°РЅРёРµРј `ProfileDto`. РўР°РєРёРј РѕР±СЂР°Р·РѕРј, СѓСЃРїРµС€РЅР°СЏ РІРµСЂРёС„РёРєР°С†РёСЏ С‚РѕРєРµРЅР° (auth stub/Firebase РІ Р±СѓРґСѓС‰РµРј) Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РѕРЅР±РѕСЂРґРёС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РІ СЃРёСЃС‚РµРјСѓ, Р° РѕСЃС‚Р°Р»СЊРЅС‹Рµ user-СЌРЅРґРїРѕРёРЅС‚С‹ (`PATCH /api/users/me/profile`, `DELETE /api/users/me`) РѕР¶РёРґР°СЋС‚ СѓР¶Рµ СЃРѕР·РґР°РЅРЅСѓСЋ Р·Р°РїРёСЃСЊ Рё РїСЂРё РµС‘ РѕС‚СЃСѓС‚СЃС‚РІРёРё РІРѕР·РІСЂР°С‰Р°СЋС‚ 404 `user not found`. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md).

- **РђСѓРґРёС‚: РїСЂРѕРІРµСЂРєР° С‡Р»РµРЅСЃС‚РІР° РґР»СЏ РєР»СѓР±РЅС‹С… С‡Р°С‚РѕРІ (HTTP + WS) (infra/README.md, 2026-02-04):** Р”Р»СЏ REST-СЌРЅРґРїРѕРёРЅС‚РѕРІ РєР»СѓР±РЅС‹С… С‡Р°С‚РѕРІ `GET /api/messages/clubs/:clubId` Рё `POST /api/messages/clubs/:clubId` РґРѕР±Р°РІР»РµРЅР° РїСЂРѕРІРµСЂРєР° С‡Р»РµРЅСЃС‚РІР°: РїРѕСЃР»Рµ auth РїРѕ `req.authUser.uid` backend РЅР°С…РѕРґРёС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ С‡РµСЂРµР· `UsersRepository.findByFirebaseUid`, Р·Р°С‚РµРј РїСЂРѕРІРµСЂСЏРµС‚ Р°РєС‚РёРІРЅРѕРµ С‡Р»РµРЅСЃС‚РІРѕ РІ РєР»СѓР±Рµ С‡РµСЂРµР· `ClubMembersRepository.findByClubAndUser(clubId, user.id)`; РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РёР»Рё РЅРµР°РєС‚РёРІРЅРѕРј СЃС‚Р°С‚СѓСЃРµ РІРѕР·РІСЂР°С‰Р°РµС‚СЃСЏ `403 forbidden` СЃ РєРѕРґРѕРј `forbidden` Рё СЃРѕРѕР±С‰РµРЅРёРµРј `User is not a member of this club`. Р’ WebSocket-СЃРµСЂРІРµСЂРµ (`chatWs.ts`) С„СѓРЅРєС†РёСЏ `canSubscribe(uid, channelKey)` С‚РµРїРµСЂСЊ, РїРѕРјРёРјРѕ РїСЂРѕРІРµСЂРєРё С„РѕСЂРјР°С‚Р° РєР°РЅР°Р»Р° `club:{clubId}`, РЅР°С…РѕРґРёС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РїРѕ `firebaseUid` Рё РїСЂРѕРІРµСЂСЏРµС‚ РµРіРѕ Р°РєС‚РёРІРЅРѕРµ С‡Р»РµРЅСЃС‚РІРѕ РІ РєР»СѓР±Рµ; РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё С‡Р»РµРЅСЃС‚РІР° РїРѕРґРїРёСЃРєР° РѕС‚РєР»РѕРЅСЏРµС‚СЃСЏ (РєР»РёРµРЅС‚ РїРѕР»СѓС‡Р°РµС‚ `{ type: 'error', message: 'Subscribe denied' }`). РўР°РєРёРј РѕР±СЂР°Р·РѕРј, РґРѕСЃС‚СѓРї Рє РєР»СѓР±РЅРѕРјСѓ С‡Р°С‚Сѓ (HTTP Рё WS) РѕРіСЂР°РЅРёС‡РµРЅ С‚РѕР»СЊРєРѕ СѓС‡Р°СЃС‚РЅРёРєР°РјРё СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‰РµРіРѕ РєР»СѓР±Р°. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).

- **РђСѓРґРёС‚: СѓРЅРёС„РёРєР°С†РёСЏ С„РѕСЂРјР°С‚Р° РѕС€РёР±РѕРє API (infra/README.md, 2026-02-04):** РћСЃС‚Р°РІС€РёРµСЃСЏ СЌРЅРґРїРѕРёРЅС‚С‹, РєРѕС‚РѕСЂС‹Рµ РІРѕР·РІСЂР°С‰Р°Р»Рё РѕС€РёР±РєРё РІ РІРёРґРµ `{ error: "..." }`, РїСЂРёРІРµРґРµРЅС‹ Рє РµРґРёРЅРѕРјСѓ С„РѕСЂРјР°С‚Сѓ ADR-0002 `{ code, message, details? }`. Р’ РјРѕРґСѓР»Рµ СЃРѕР±С‹С‚РёР№ (`events.routes.ts`) `GET /api/events`, `GET /api/events/:id`, `GET /api/events/:id/participants` Рё `POST /api/events` С‚РµРїРµСЂСЊ РїСЂРё РІРЅСѓС‚СЂРµРЅРЅРёС… РѕС€РёР±РєР°С… РІРѕР·РІСЂР°С‰Р°СЋС‚ `500` СЃ `{ code: "internal_error", message: "Internal server error" }`, Р° РѕС‚СЃСѓС‚СЃС‚РІРёРµ СЃРѕР±С‹С‚РёСЏ (`Event not found`) РІ `GET /api/events/:id` Рё `GET /api/events/:id/participants` РѕС‚РґР°С‘С‚ `404` СЃ `{ code: "not_found", message: "Event not found", details: { eventId } }`. Р’ РјРѕРґСѓР»Рµ РєР°СЂС‚С‹ (`map.routes.ts`) `GET /api/map/data` РїСЂРё РІРЅСѓС‚СЂРµРЅРЅРёС… РѕС€РёР±РєР°С… С‚Р°РєР¶Рµ РІРѕР·РІСЂР°С‰Р°РµС‚ `500` СЃ `{ code: "internal_error", message: "Internal server error" }` РІРјРµСЃС‚Рѕ `{ error: "Internal server error" }`. РћСЃС‚Р°Р»СЊРЅС‹Рµ СЂРѕСѓС‚РµСЂС‹ СѓР¶Рµ РёСЃРїРѕР»СЊР·РѕРІР°Р»Рё С„РѕСЂРјР°С‚ ADR-0002 СЂР°РЅРµРµ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md), [changes/maps.md](changes/maps.md), [docs/api-errors-and-validation.md](api-errors-and-validation.md).

- **РђСѓРґРёС‚: С„Р»РѕСѓ СЃРѕР±С‹С‚РёР№ РЅР° mobile (СЃРѕР·РґР°РЅРёРµ, join, check-in, С„РёР»СЊС‚СЂС‹) (infra/README.md, 2026-02-04):** РќР° СЃС‚РѕСЂРѕРЅРµ mobile Р·Р°РІРµСЂС€С‘РЅ РјРёРЅРёРјР°Р»СЊРЅС‹Р№ С„Р»РѕСѓ СЂР°Р±РѕС‚С‹ СЃ СЃРѕР±С‹С‚РёСЏРјРё. Р­РєСЂР°РЅ СЃРїРёСЃРєР° (`EventsScreen`) РёСЃРїРѕР»СЊР·СѓРµС‚ `EventsService.getEvents(cityId, dateFilter, clubId, onlyOpen, ...)`, С„РёР»СЊС‚СЂС‹ РґР°С‚С‹, В«РўРѕР»СЊРєРѕ РѕС‚РєСЂС‹С‚С‹РµВ» Рё В«РњРѕР№ РєР»СѓР±В» СЂРµР°Р»СЊРЅРѕ РїСЂРѕРєРёРґС‹РІР°СЋС‚СЃСЏ РЅР° backend (С‡РµСЂРµР· query-РїР°СЂР°РјРµС‚СЂС‹), Р° FAB РІРµРґС‘С‚ РЅР° `CreateEventScreen`, РіРґРµ `EventsService.createEvent()` СЃРѕР·РґР°С‘С‚ СЃРѕР±С‹С‚РёРµ Рё РїРѕСЃР»Рµ СѓСЃРїРµС…Р° РІС‹РїРѕР»РЅСЏРµС‚СЃСЏ РїРµСЂРµС…РѕРґ РЅР° `EventDetailsScreen` РїРѕ `event.id`. Р”РµС‚Р°Р»СЊРЅС‹Р№ СЌРєСЂР°РЅ (`EventDetailsScreen`) Р·Р°РІРµСЂС€С‘РЅ РІ С‡Р°СЃС‚Рё СѓС‡Р°СЃС‚РёСЏ Рё check-in: РєРЅРѕРїРєРё В«РџСЂРёСЃРѕРµРґРёРЅРёС‚СЊСЃСЏВ» / В«Р’С‹ СѓС‡Р°СЃС‚РІСѓРµС‚РµВ» / В«РћС‚РјРµРЅРёС‚СЊ СѓС‡Р°СЃС‚РёРµВ» РІС‹Р·С‹РІР°СЋС‚ `EventsService.joinEvent/leaveEvent` Рё РѕР±РЅРѕРІР»СЏСЋС‚ СЃРѕСЃС‚РѕСЏРЅРёРµ, Р° РЅРѕРІР°СЏ РєРЅРѕРїРєР° check-in РґР»СЏ СѓС‡Р°СЃС‚РЅРёРєРѕРІ РёСЃРїРѕР»СЊР·СѓРµС‚ `LocationService.getCurrentPosition()` Рё `EventsService.checkInEvent(eventId, longitude, latitude)`; РІСЃРµ РѕС€РёР±РєРё РѕР±СЂР°Р±Р°С‚С‹РІР°СЋС‚СЃСЏ С‡РµСЂРµР· `ApiException` СЃ РєРѕРґР°РјРё ADR-0002 Рё РїРѕРєР°Р·С‹РІР°СЋС‚СЃСЏ С‡РµСЂРµР· Snackbar СЃ Р»РѕРєР°Р»РёР·РѕРІР°РЅРЅС‹РјРё С‚РµРєСЃС‚Р°РјРё `eventJoinError` / `eventLeaveError` / `eventCheckInError`. РњРµС‚РѕРґС‹ `getEventById` Рё `getEventParticipants` РІ `EventsService` С‚Р°РєР¶Рµ РїСЂРёРІРµРґРµРЅС‹ Рє РµРґРёРЅРѕР№ РѕР±СЂР°Р±РѕС‚РєРµ РѕС€РёР±РѕРє (С‡РµСЂРµР· `ApiException`), СѓСЃС‚СЂР°РЅСЏСЏ РїР°РґРµРЅРёСЏ РїСЂРё 404/500. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md).

- **РђСѓРґРёС‚: СѓР±СЂР°С‚СЊ РјРѕРєРё Рё РїРѕРґРєР»СЋС‡РёС‚СЊ СЂРµР°Р»СЊРЅС‹Рµ РґР°РЅРЅС‹Рµ РґР»СЏ С‚РµСЂСЂРёС‚РѕСЂРёР№/РєР»СѓР±РѕРІ/Р°РєС‚РёРІРЅРѕСЃС‚РµР№ (infra/README.md, 2026-02-04):** Р”Р»СЏ С‚РµСЂСЂРёС‚РѕСЂРёР№ Рё РєР°СЂС‚С‹ РІРјРµСЃС‚Рѕ Р°Р±СЃС‚СЂР°РєС‚РЅС‹С… "Test Territory"/Р»РѕРєР°Р»СЊРЅС‹С… mockвЂ‘РјР°СЃСЃРёРІРѕРІ РІРІРµРґС‘РЅ РєРѕРЅС„РёРі `modules/territories/territories.config.ts` СЃ С‚СЂРµРјСЏ СЂРµР°Р»СЊРЅС‹РјРё РїРѕРїСѓР»СЏСЂРЅС‹РјРё Р±РµРіРѕРІС‹РјРё Р»РѕРєР°С†РёСЏРјРё РІ РЎР°РЅРєС‚вЂ‘РџРµС‚РµСЂР±СѓСЂРіРµ (`spb-primorsky-park-pobedy`, `spb-yalagin-island`, `spb-park-300`), Р° СЌРЅРґРїРѕРёРЅС‚С‹ `GET /api/territories` Рё `GET /api/map/data` РёСЃРїРѕР»СЊР·СѓСЋС‚ `getTerritoriesForCity(cityId, clubId?)` / `getTerritoryById(id)` Рё РєРѕСЂСЂРµРєС‚РЅРѕ РѕР±СЂР°Р±Р°С‚С‹РІР°СЋС‚ 404. Р”Р»СЏ РєР»СѓР±РѕРІ `GET /api/clubs` Р±РѕР»СЊС€Рµ РЅРµ РІРѕР·РІСЂР°С‰Р°РµС‚ `Test Club`, Р° РѕС‚РґР°С‘С‚ СЃС‚Р°С‚РёС‡РµСЃРєРёР№ СЃРїРёСЃРѕРє РѕСЃРјС‹СЃР»РµРЅРЅС‹С… РєР»СѓР±РѕРІ (`club-1` / `club-2`), СЃРІСЏР·Р°РЅРЅС‹С… СЃ СЌС‚РёРјРё С‚РµСЂСЂРёС‚РѕСЂРёСЏРјРё. РђРєС‚РёРІРЅРѕСЃС‚Рё РїРѕвЂ‘РїСЂРµР¶РЅРµРјСѓ РѕСЃС‚Р°СЋС‚СЃСЏ skeletonвЂ‘Р·Р°РіР»СѓС€РєР°РјРё Р±РµР· Р‘Р”, РЅРѕ Р±Р°Р·РѕРІС‹Р№ РєРѕРЅС‚СЂР°РєС‚ Рё runtimeвЂ‘РІР°Р»РёРґР°С†РёСЏ СѓР¶Рµ РµСЃС‚СЊ; РґР°РЅРЅС‹Рµ РґР»СЏ С‚РµСЂСЂРёС‚РѕСЂРёР№ Рё РєР»СѓР±РѕРІ СЃС‚Р°Р»Рё СЂРµР°Р»РёСЃС‚РёС‡РЅС‹РјРё Рё СЃРѕРіР»Р°СЃРѕРІР°РЅРЅС‹РјРё СЃ РєР°СЂС‚РѕР№. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/territories.md](changes/territories.md), [changes/maps.md](changes/maps.md), [changes/clubs.md](changes/clubs.md).

- **РђСѓРґРёС‚: mobile chat API РґР»СЏ РєР»СѓР±РЅС‹С…/Р»РёС‡РЅС‹С… С‡Р°С‚РѕРІ (infra/README.md, 2026-02-04):** Р’ `MessagesService` СЂРµР°Р»РёР·РѕРІР°РЅ HTTPвЂ‘РєР»РёРµРЅС‚ РґР»СЏ РєР»СѓР±РЅС‹С… С‡Р°С‚РѕРІ РїРѕРІРµСЂС… СЃСѓС‰РµСЃС‚РІСѓСЋС‰РёС… backendвЂ‘СЌРЅРґРїРѕРёРЅС‚РѕРІ: `getClubChats()` (GET `/api/messages/clubs` в†’ `ClubChatModel[]`), `getClubChatMessages(clubId, { limit, offset })` (GET `/api/messages/clubs/:clubId`) Рё `sendClubMessage(clubId, text)` (POST `/api/messages/clubs/:clubId`, РІРѕР·РІСЂР°С‰Р°РµС‚ `MessageModel`). Р’Рѕ РІСЃРµС… С‚СЂС‘С… РјРµС‚РѕРґР°С… РѕС€РёР±РєРё 4xx/5xx СЂР°Р·Р±РёСЂР°СЋС‚СЃСЏ РїРѕ ADRвЂ‘С„РѕСЂРјР°С‚Сѓ `{ code, message }` Рё РїСЂРѕР±СЂР°СЃС‹РІР°СЋС‚СЃСЏ РІ РІРёРґРµ `ApiException`, С‡С‚РѕР±С‹ UI РјРѕРі РїРѕРєР°Р·С‹РІР°С‚СЊ Р»РѕРєР°Р»РёР·РѕРІР°РЅРЅС‹Рµ СЃРѕРѕР±С‰РµРЅРёСЏ. Р”Р»СЏ Р»РёС‡РЅС‹С… С‡Р°С‚РѕРІ backendвЂ‘API РµС‰С‘ РЅРµС‚, РїРѕСЌС‚РѕРјСѓ `getPrivateChats()` Рё `getChatMessages(chatId)` РІРѕР·РІСЂР°С‰Р°СЋС‚ РїСѓСЃС‚С‹Рµ СЃРїРёСЃРєРё (stub), Р° `sendChatMessage` СЏРІРЅРѕ Р±СЂРѕСЃР°РµС‚ `UnimplementedError('Personal chats are not implemented in MVP')`. РўР°Р± "Р›РёС‡РЅС‹Рµ" РїРѕвЂ‘РїСЂРµР¶РЅРµРјСѓ РѕС‚РѕР±СЂР°Р¶Р°РµС‚ `personalChatsEmpty`, С‡С‚Рѕ СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓРµС‚ РґРѕРјРµРЅРЅРѕР№ СЃРїРµС†РёС„РёРєР°С†РёРё (Р»РёС‡РЅС‹Рµ РїРµСЂРµРїРёСЃРєРё РЅРµ РІС…РѕРґСЏС‚ РІ MVP). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).

- **РђСѓРґРёС‚: С‚СЂР°РЅР·Р°РєС†РёРѕРЅРЅР°СЏ Р·Р°С‰РёС‚Р° participant_limit РґР»СЏ СЃРѕР±С‹С‚РёР№ (infra/README.md, 2026-02-04):** Р’ `EventsRepository.joinEvent` РїРѕРґС‚РІРµСЂР¶РґРµРЅР° Рё Р·Р°РґРѕРєСѓРјРµРЅС‚РёСЂРѕРІР°РЅР° С‚РµРєСѓС‰Р°СЏ РјРѕРґРµР»СЊ РѕРіСЂР°РЅРёС‡РµРЅРёСЏ СѓС‡Р°СЃС‚РЅРёРєРѕРІ: РїСЂРѕРІРµСЂРєР° СЃС‚Р°С‚СѓСЃР° СЃРѕР±С‹С‚РёСЏ (`OPEN`/`FULL`) Рё `participantLimit` РїСЂРѕРёСЃС…РѕРґРёС‚ РїРµСЂРµРґ СЃРѕР·РґР°РЅРёРµРј/РѕР±РЅРѕРІР»РµРЅРёРµРј Р·Р°РїРёСЃРё РІ `event_participants`, РїРѕСЃР»Рµ С‡РµРіРѕ `updateParticipantCount()` РїРµСЂРµСЃС‡РёС‚С‹РІР°РµС‚ `participant_count` Рё РѕР±РЅРѕРІР»СЏРµС‚ СЃС‚Р°С‚СѓСЃ СЃРѕР±С‹С‚РёСЏ (РїСЂРё РґРѕСЃС‚РёР¶РµРЅРёРё Р»РёРјРёС‚Р° в†’ `FULL`, РїСЂРё РѕСЃРІРѕР±РѕР¶РґРµРЅРёРё РјРµСЃС‚ вЂ” РѕР±СЂР°С‚РЅРѕ РІ `OPEN`). РЇРІРЅС‹С… SQLвЂ‘С‚СЂР°РЅР·Р°РєС†РёР№ Рё rowвЂ‘level locking РїРѕРєР° РЅРµС‚ (skeletonвЂ‘СЌС‚Р°Рї, СѓРїСЂРѕС‰С‘РЅРЅС‹Р№ DBвЂ‘stub), СЌС‚Рѕ РѕС‚РјРµС‡РµРЅРѕ РєР°Рє TODO РґР»СЏ Р±СѓРґСѓС‰РµРіРѕ СЌС‚Р°РїР° СЃ СЂРµР°Р»СЊРЅРѕР№ Р‘Р” Рё РЅР°РіСЂСѓР·РєРѕР№; РЅР° С‚РµРєСѓС‰РµРј СЌС‚Р°РїРµ СЌС‚РѕРіРѕ РґРѕСЃС‚Р°С‚РѕС‡РЅРѕ РґР»СЏ РїСЂРµРґРѕС‚РІСЂР°С‰РµРЅРёСЏ РѕРІРµСЂСЃР°Р±СЃРєСЂР°Р№Р±Р° РІ С‚РёРїРёС‡РЅРѕРј РѕРґРЅРѕРїРѕС‚РѕС‡РЅРѕРј/РЅРёР·РєРѕРєРѕРЅРєСѓСЂРµРЅС‚РЅРѕРј РѕРєСЂСѓР¶РµРЅРёРё. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md).

- **РђСѓРґРёС‚: РёСЃРїСЂР°РІРёС‚СЊ 500 РЅР° /api/messages РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё auth (infra/README.md, 2026-02-04):** Р’ `messages.routes.ts` РІРјРµСЃС‚Рѕ РІС‹Р±СЂР°СЃС‹РІР°РЅРёСЏ РёСЃРєР»СЋС‡РµРЅРёСЏ РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё `req.authUser.uid` (С‡С‚Рѕ РїСЂРёРІРѕРґРёР»Рѕ Рє РѕР±С‰РµР№ 500 internal_error) РґРѕР±Р°РІР»РµРЅ helper `getAuthUidOrRespondUnauthorized(req, res)`, РєРѕС‚РѕСЂС‹Р№ РІРѕР·РІСЂР°С‰Р°РµС‚ 401 СЃ ADRвЂ‘РѕС€РёР±РєРѕР№ `unauthorized` Рё РїСЂРёС‡РёРЅРѕР№ `missing_header` Рё Р·Р°РІРµСЂС€Р°РµС‚ РѕР±СЂР°Р±РѕС‚РєСѓ Р·Р°РїСЂРѕСЃР°. Р’СЃРµ РјР°СЂС€СЂСѓС‚С‹ `/api/messages/clubs` / `/api/messages/clubs/:clubId` (GET/POST) РёСЃРїРѕР»СЊР·СѓСЋС‚ СЌС‚РѕС‚ helper РїРµСЂРµРґ РґРѕСЃС‚СѓРїРѕРј Рє РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ Рё РїСЂРѕРІРµСЂРєРѕР№ С‡Р»РµРЅСЃС‚РІР° РІ РєР»СѓР±Рµ, С‚Р°Рє С‡С‚Рѕ С‚РµРїРµСЂСЊ РїСЂРё Р·Р°РїСЂРѕСЃР°С… Р±РµР· С‚РѕРєРµРЅР° РєР»РёРµРЅС‚С‹ СЃС‚Р°Р±РёР»СЊРЅРѕ РїРѕР»СѓС‡Р°СЋС‚ 401/403 РІРјРµСЃС‚Рѕ 500. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **РђСѓРґРёС‚: Firebase Admin SDK Рё production baseUrl РґР»СЏ mobile (infra/README.md, 2026-02-04):**
  - **Firebase Admin SDK:** Р’ `FirebaseAuthProvider` РёРЅС‚РµРіСЂРёСЂРѕРІР°РЅ `firebase-admin`: РїСЂРё РЅР°Р»РёС‡РёРё `FIREBASE_PROJECT_ID`, `FIREBASE_CLIENT_EMAIL`, `FIREBASE_PRIVATE_KEY` backend РёРЅРёС†РёР°Р»РёР·РёСЂСѓРµС‚ Admin SDK Рё РёСЃРїРѕР»СЊР·СѓРµС‚ `admin.auth().verifyIdToken()` РґР»СЏ РїСЂРѕРІРµСЂРєРё С‚РѕРєРµРЅРѕРІ; РІ production РѕС‚СЃСѓС‚СЃС‚РІРёРµ СЌС‚РёС… РїРµСЂРµРјРµРЅРЅС‹С… РїСЂРёРІРѕРґРёС‚ Рє РїР°РґРµРЅРёСЋ СЃС‚Р°СЂС‚Р° СЃРµСЂРІРµСЂР° С‡РµСЂРµР· `assertFirebaseAuthConfigured()`, РІ non-prod Р±РµР· РєРѕРЅС„РёРіСѓСЂР°С†РёРё РѕСЃС‚Р°С‘С‚СЃСЏ Р±РµР·РѕРїР°СЃРЅР°СЏ Р·Р°РіР»СѓС€РєР° (derive uid РёР· С‚РѕРєРµРЅР°) РґР»СЏ СѓРґРѕР±СЃС‚РІР° СЂР°Р·СЂР°Р±РѕС‚РєРё. Р”РѕР±Р°РІР»РµРЅР° Р·Р°РІРёСЃРёРјРѕСЃС‚СЊ `firebase-admin` Рё РѕР±РЅРѕРІР»РµРЅР° РґРѕРєСѓРјРµРЅС‚Р°С†РёСЏ (`changes/auth.md`, `firebase-setup.md`, `backend/README.md`).
  - **Production baseUrl РґР»СЏ mobile:** Р’ `ApiConfig.getBaseUrl()` С„РёРєСЃРёСЂРѕРІР°РЅ РїСЂРѕРґР°РєС€РЅ backend РґР»СЏ РјРѕР±РёР»СЊРЅС‹С…/РґРµСЃРєС‚РѕРївЂ‘РєР»РёРµРЅС‚РѕРІ: РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё `API_BASE_URL` Рё РІ releaseвЂ‘СЃР±РѕСЂРєРµ РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ `https://85.208.85.13:3000` (Р±РµР· localhost), РІ debug РїРѕвЂ‘РїСЂРµР¶РЅРµРјСѓ `http://85.208.85.13:3000`, Р° РґР»СЏ Flutter Web РґРµС„РѕР»С‚ РѕСЃС‚Р°С‘С‚СЃСЏ `https://localhost:3000` (РѕР¶РёРґР°РµС‚СЃСЏ reverse-proxy). РџРѕРІРµРґРµРЅРёРµ Р·Р°РґРѕРєСѓРјРµРЅС‚РёСЂРѕРІР°РЅРѕ РІ `changes/api-client.md`.

### 2026-02-05
- **Tests: events/clubs/users + mobile models:** Added API tests for event leave and club leave, membership flags, repository tests for leaveEvent and birthDate mapping, and Flutter model tests for EventDetails/Club membership fields.
- **Fix: СѓС‡Р°СЃС‚РёРµ РІ СЃРѕР±С‹С‚РёСЏС… + СЃРѕР·РґР°РЅРёРµ СЃРѕР±С‹С‚РёСЏ + СЂР°СЃС€РёСЂРµРЅРёРµ РїСЂРѕС„РёР»СЏ:** Р”РѕР±Р°РІР»РµРЅС‹ В«Р’С‹ СѓС‡Р°СЃС‚РІСѓРµС‚РµВ»/В«РћС‚РјРµРЅРёС‚СЊ СѓС‡Р°СЃС‚РёРµВ» (backend `POST /api/events/:id/leave`, СЃС‚Р°С‚СѓСЃ СѓС‡Р°СЃС‚РёСЏ РІ РґРµС‚Р°Р»СЏС…) Рё СЌРєСЂР°РЅ СЃРѕР·РґР°РЅРёСЏ СЃРѕР±С‹С‚РёСЏ РЅР° mobile (FAB в†’ CreateEventScreen, `createEvent()` РїРѕРґРєР»СЋС‡С‘РЅ Рє API). РџСЂРѕС„РёР»СЊ СЂР°СЃС€РёСЂРµРЅ Р»РёС‡РЅС‹РјРё РґР°РЅРЅС‹РјРё (РёРјСЏ/С„Р°РјРёР»РёСЏ/РґР°С‚Р° СЂРѕР¶РґРµРЅРёСЏ/СЃС‚СЂР°РЅР°/РїРѕР»), РґРѕР±Р°РІР»РµРЅР° РјРёРіСЂР°С†РёСЏ `007_users_profile_fields.sql`, С„РѕСЂРјР° СЂРµРґР°РєС‚РёСЂРѕРІР°РЅРёСЏ Рё СЃРµРєС†РёСЏ РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md), [changes/users.md](changes/users.md).
- **Fix: РїРѕР»/РґР°С‚Р° СЂРѕР¶РґРµРЅРёСЏ/РєР»СѓР±С‹/С‚РµРєСЃС‚ join:** РџРѕР» РѕРіСЂР°РЅРёС‡РµРЅ В«РјСѓР¶СЃРєРѕР№/Р¶РµРЅСЃРєРёР№В» (РјРёРіСЂР°С†РёСЏ `008_users_gender_restrict.sql`, UI Р±РµР· other/unknown), РґР°С‚Р° СЂРѕР¶РґРµРЅРёСЏ РІРѕР·РІСЂР°С‰Р°РµС‚СЃСЏ Р±РµР· UTCвЂ‘СЃРґРІРёРіР°, joinвЂ‘С‚РµРєСЃС‚ Р±РѕР»СЊС€Рµ РЅРµ СЃРѕРґРµСЂР¶РёС‚ TODO, РґРѕР±Р°РІР»РµРЅ РІС‹С…РѕРґ РёР· РєР»СѓР±Р° (`POST /api/clubs/:id/leave` + РєРЅРѕРїРєР°). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md), [changes/clubs.md](changes/clubs.md), [changes/events.md](changes/events.md).

### 2026-02-04
- **Fix: С„РёРґР±РµРє С‚РµСЃС‚Р° (СѓС‡Р°СЃС‚РЅРёРєРё/РєР»СѓР±С‹/РїСЂРѕС„РёР»СЊ/СЃРѕРѕР±С‰РµРЅРёСЏ):** Р—Р°РєСЂС‹С‚С‹ РїСѓРЅРєС‚С‹ РёР· feedback СЃРµРєС†РёРё infra/README. Backend: non-prod auth stub Р±РѕР»СЊС€Рµ РЅРµ РІРѕР·РІСЂР°С‰Р°РµС‚ С„РёРєСЃРёСЂРѕРІР°РЅРЅС‹Р№ uid (uid РёР· JWT РёР»Рё С…СЌС€Р° С‚РѕРєРµРЅР°), РґРѕР±Р°РІР»РµРЅ `GET /api/events/:id/participants`, РїСЂРѕС„РёР»СЊ РІРѕР·РІСЂР°С‰Р°РµС‚ `club` РїРѕ `primaryClubId`, РґРѕР±Р°РІР»РµРЅ `GET /api/messages/clubs` РЅР° РѕСЃРЅРѕРІРµ `club_members`. Mobile: `ParticipantsList` Р·Р°РіСЂСѓР¶Р°РµС‚ СѓС‡Р°СЃС‚РЅРёРєРѕРІ РёР· API, РїСЂРѕС„РёР»СЊ РёСЃРїРѕР»СЊР·СѓРµС‚ fallback РїРѕ `primaryClubId`, `MessagesService.getClubChats()` РїРѕРґРєР»СЋС‡С‘РЅ Рє backend. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md), [changes/users.md](changes/users.md), [changes/messages.md](changes/messages.md), [changes/auth.md](changes/auth.md).
- **Fix: РџРѕРІС‚РѕСЂРЅС‹Р№ СЃС‚Р°СЂС‚ РїСЂРѕР±РµР¶РєРё вЂ” `Exception: Run already started` (mobile):** РСЃРїСЂР°РІР»РµРЅР° РѕС€РёР±РєР°, РїСЂРё РєРѕС‚РѕСЂРѕР№ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РЅРµ РјРѕРі РЅР°С‡Р°С‚СЊ РЅРѕРІСѓСЋ РїСЂРѕР±РµР¶РєСѓ РїРѕСЃР»Рµ Р·Р°РІРµСЂС€РµРЅРёСЏ РїСЂРµРґС‹РґСѓС‰РµР№ РёР»Рё РїСЂРё РѕС€РёР±РєРµ РѕС‚РїСЂР°РІРєРё. РџСЂРёС‡РёРЅР°: `RunService._currentSession` РѕС‡РёС‰Р°Р»Р°СЃСЊ С‚РѕР»СЊРєРѕ РїСЂРё СѓСЃРїРµС€РЅРѕРј `submitRun()` РёР»Рё СЏРІРЅРѕРј `cancelRun()`. Р РµС€РµРЅРёРµ: (1) РґРѕР±Р°РІР»РµРЅ РјРµС‚РѕРґ `clearCompletedSession()` РІ `RunService`; (2) `startRun()` Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РѕС‡РёС‰Р°РµС‚ completed-СЃРµСЃСЃРёРё; (3) `RunScreen.initState()` РІРѕСЃСЃС‚Р°РЅР°РІР»РёРІР°РµС‚ UI РґР»СЏ running Рё completed СЃРµСЃСЃРёР№; (4) `_backToIdle()` РІС‹Р·С‹РІР°РµС‚ `clearCompletedSession()`; (5) РїСЂРё РёСЃРєР»СЋС‡РµРЅРёРё В«Run already startedВ» РїРѕРєР°Р·С‹РІР°РµС‚СЃСЏ РґРёР°Р»РѕРі СЃ РІС‹Р±РѕСЂРѕРј В«РџСЂРѕРґРѕР»Р¶РёС‚СЊВ» РёР»Рё В«РћС‚РјРµРЅРёС‚СЊ Рё РЅР°С‡Р°С‚СЊ Р·Р°РЅРѕРІРѕВ». Р”РѕР±Р°РІР»РµРЅС‹ i18n РєР»СЋС‡Рё (EN/RU). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md), [errors-runbook.md](errors-runbook.md).

- **Code review вЂ” РљР°СЂС‚Р° Рё С‚СЂРµРєРёРЅРі (infra/README.md):** РџСЂРѕРІРµСЂРµРЅР° СЂРµР°Р»РёР·Р°С†РёСЏ С‚СЂС‘С… РїСѓРЅРєС‚РѕРІ СЂР°Р·РґРµР»Р° В«РљР°СЂС‚Р° Рё С‚СЂРµРєРёРЅРіВ». РќР°Р№РґРµРЅР° Рё РёСЃРїСЂР°РІР»РµРЅР° РѕРґРЅР° РїСЂРѕР±Р»РµРјР°: РІ `map_screen.dart` РІ РјРµС‚РѕРґРµ `_showClubsBottomSheet()` РїСЂРё РѕС€РёР±РєРµ Р·Р°РіСЂСѓР·РєРё СЃРїРёСЃРєР° РєР»СѓР±РѕРІ РєРЅРѕРїРєР° РїРѕРєР°Р·С‹РІР°Р»Р° С‚РµРєСЃС‚ В«РџРѕРІС‚РѕСЂРёС‚СЊВ» (`retry`), РЅРѕ С„Р°РєС‚РёС‡РµСЃРєРё Р·Р°РєСЂС‹РІР°Р»Р° bottom sheet (`Navigator.pop`); РёСЃРїСЂР°РІР»РµРЅРѕ РЅР° `cancel` (В«Р—Р°РєСЂС‹С‚СЊВ»). РћСЃС‚Р°Р»СЊРЅР°СЏ СЂРµР°Р»РёР·Р°С†РёСЏ РєРѕСЂСЂРµРєС‚РЅР°: РЅР°РІРёРіР°С†РёСЏ FindClubAction/CreateClubAction, РїР°СЂР°РјРµС‚СЂ showClubs РІ MapScreen, С„РѕСЂРјР° CreateClubScreen, ClubsService.createClub(), i18n РєР»СЋС‡Рё. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/maps.md](changes/maps.md).
- **РљР°СЂС‚Р° Рё С‚СЂРµРєРёРЅРі (infra/README.md):** Р РµР°Р»РёР·РѕРІР°РЅС‹ С‚СЂРё РїСѓРЅРєС‚Р° СЂР°Р·РґРµР»Р° В«РљР°СЂС‚Р° Рё С‚СЂРµРєРёРЅРіВ». (1) РљРЅРѕРїРєР° В«РќР°Р№С‚Рё РєР»СѓР±В»: РїРµСЂРµС…РѕРґ РЅР° РєР°СЂС‚Сѓ СЃ query `showClubs=true`; MapScreen РїСЂРё РѕС‚РєСЂС‹С‚РёРё СЃ СЌС‚РёРј РїР°СЂР°РјРµС‚СЂРѕРј РїРѕРєР°Р·С‹РІР°РµС‚ bottom sheet СЃРѕ СЃРїРёСЃРєРѕРј РєР»СѓР±РѕРІ РіРѕСЂРѕРґР° (ClubsService.getClubs); С‚Р°Рї РїРѕ РєР»СѓР±Сѓ вЂ” РїРµСЂРµС…РѕРґ РЅР° СЌРєСЂР°РЅ РєР»СѓР±Р°. (2) РљРЅРѕРїРєР° В«РЎРѕР·РґР°С‚СЊ РєР»СѓР±В»: РЅР°РІРёРіР°С†РёСЏ CreateClubAction в†’ `/club/create`; СЌРєСЂР°РЅ CreateClubScreen СЃ С„РѕСЂРјРѕР№ (РЅР°Р·РІР°РЅРёРµ, РѕРїРёСЃР°РЅРёРµ), РіРѕСЂРѕРґ РёР· CurrentCityService; ClubsService.createClub() вЂ” POST /api/clubs; РїСЂРё СѓСЃРїРµС…Рµ РїРµСЂРµС…РѕРґ РЅР° СЌРєСЂР°РЅ СЃРѕР·РґР°РЅРЅРѕРіРѕ РєР»СѓР±Р°. (3) РЈР±СЂР°РЅС‹ СЃ РєР°СЂС‚С‹ С„РёР»СЊС‚СЂС‹: СѓРґР°Р»РµРЅС‹ РїР°РЅРµР»СЊ С„РёР»СЊС‚СЂРѕРІ (СЃРµРіРѕРґРЅСЏ/РЅРµРґРµР»СЏ/РјРѕР№ РєР»СѓР±/С‚РѕР»СЊРєРѕ Р°РєС‚РёРІРЅС‹Рµ С‚РµСЂСЂРёС‚РѕСЂРёРё), РєРЅРѕРїРєР° С„РёР»СЊС‚СЂР° РІ AppBar; РґР°РЅРЅС‹Рµ РєР°СЂС‚С‹ Р·Р°РїСЂР°С€РёРІР°СЋС‚СЃСЏ С‚РѕР»СЊРєРѕ СЃ cityId. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/maps.md](changes/maps.md), [changes/clubs.md](changes/clubs.md).
- **РўСЂРµРєРёРЅРі РїСЂРѕР±РµР¶РєРё РЅР° РєР°СЂС‚Рµ вЂ” РѕС‚РѕР±СЂР°Р¶РµРЅРёРµ РјР°СЂС€СЂСѓС‚Р° РІ СЂРµР°Р»СЊРЅРѕРј РІСЂРµРјРµРЅРё РІРѕ РІСЂРµРјСЏ Р±РµРіР° (mobile):** Р’ СЃРѕСЃС‚РѕСЏРЅРёРё running СЌРєСЂР°РЅР° Run РґРѕР±Р°РІР»РµРЅР° РєР°СЂС‚Р° (Yandex MapKit) СЃ РїРѕР»РёР»РёРЅРёРµР№ РјР°СЂС€СЂСѓС‚Р° РёР· GPS-С‚РѕС‡РµРє СЃРµСЃСЃРёРё. Р’РёРґР¶РµС‚ `RunRouteMap` РїСЂРёРЅРёРјР°РµС‚ `gpsPoints`, СЂРёСЃСѓРµС‚ РїРѕР»РёР»РёРЅРёСЋ РїСЂРё РґРІСѓС… Рё Р±РѕР»РµРµ С‚РѕС‡РєР°С…; РєР°РјРµСЂР° РїСЂРё РїРµСЂРІРѕРј РїРѕСЏРІР»РµРЅРёРё С‚РѕС‡РєРё С†РµРЅС‚СЂРёСЂСѓРµС‚СЃСЏ РЅР° РЅРµР№ (zoom 16), РїСЂРё РїРѕСЏРІР»РµРЅРёРё РЅРѕРІС‹С… С‚РѕС‡РµРє СЃР»РµРґСѓРµС‚ Р·Р° РїРѕСЃР»РµРґРЅРµР№ РїРѕР·РёС†РёРµР№. РќР°С‡Р°Р»СЊРЅР°СЏ РїРѕР·РёС†РёСЏ РєР°СЂС‚С‹ РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё С‚РѕС‡РµРє вЂ” С†РµРЅС‚СЂ С‚РµРєСѓС‰РµРіРѕ РіРѕСЂРѕРґР° (CurrentCityService) РёР»Рё РЎРџР±. Backend Р±РµР· РёР·РјРµРЅРµРЅРёР№. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md), [changes/maps.md](changes/maps.md).
- **Code review вЂ” РўСЂРµРєРёРЅРі РїСЂРѕР±РµР¶РєРё РЅР° РєР°СЂС‚Рµ:** РџСЂРѕРІРµСЂРµРЅР° СЂРµР°Р»РёР·Р°С†РёСЏ РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ РјР°СЂС€СЂСѓС‚Р° РІ СЂРµР°Р»СЊРЅРѕРј РІСЂРµРјРµРЅРё. РќР°Р№РґРµРЅР° Рё РёСЃРїСЂР°РІР»РµРЅР° РѕРґРЅР° РїСЂРѕР±Р»РµРјР°: РІ `run_screen.dart` РІ РјРµС‚РѕРґРµ `_buildRunningContent()` РґР»СЏ РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ GPS-СЃС‚Р°С‚СѓСЃР° РёСЃРїРѕР»СЊР·РѕРІР°Р»РёСЃСЊ РѕРґРЅРѕРІСЂРµРјРµРЅРЅРѕ `Icon(Icons.location_on)` Рё СЌРјРѕРґР·Рё `рџ“Ќ` РІ С‚РµРєСЃС‚Рµ (РґСѓР±Р»РёСЂРѕРІР°РЅРёРµ РёРєРѕРЅРєРё). РСЃРїСЂР°РІР»РµРЅРѕ: СЌРјРѕРґР·Рё СѓРґР°Р»С‘РЅ РёР· С‚РµРєСЃС‚Р°, РѕСЃС‚Р°РІР»РµРЅР° С‚РѕР»СЊРєРѕ Material-РёРєРѕРЅРєР°. РћСЃС‚Р°Р»СЊРЅР°СЏ СЂРµР°Р»РёР·Р°С†РёСЏ РєРѕСЂСЂРµРєС‚РЅР°: РІРёРґР¶РµС‚ `RunRouteMap` РїСЂР°РІРёР»СЊРЅРѕ СЃС‚СЂРѕРёС‚ РїРѕР»РёР»РёРЅРёСЋ, СЃР»РµРґСѓРµС‚ Р·Р° Р±РµРіСѓРЅРѕРј, РєРѕСЂСЂРµРєС‚РЅРѕ РѕР±СЂР°Р±Р°С‚С‹РІР°РµС‚ fallback РЅР° С†РµРЅС‚СЂ РіРѕСЂРѕРґР°. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Р’С‹Р±РѕСЂ РіРѕСЂРѕРґР° Рё РЎРѕР±С‹С‚РёСЏ РґР»СЏ РїСЂРёРјРµСЂР°:** (1) Р’С‹Р±РѕСЂ РіРѕСЂРѕРґР°: РІ GET `/api/users/me/profile` РґРѕР±Р°РІР»РµРЅРѕ Р·Р°РїРѕР»РЅРµРЅРёРµ `cityName` РёР· РєРѕРЅС„РёРіР° РіРѕСЂРѕРґРѕРІ (`findCityById(user.cityId)?.name`); РІ ProfileScreen Р±Р»РѕРє В«Р“РѕСЂРѕРґВ» РѕС‚РѕР±СЂР°Р¶Р°РµС‚ РЅР°Р·РІР°РЅРёРµ РіРѕСЂРѕРґР° (cityName РёР»Рё fallback РЅР° cityId). (2) РЎРѕР±С‹С‚РёСЏ РґР»СЏ РїСЂРёРјРµСЂР°: РґРѕР±Р°РІР»РµРЅР° РјРёРіСЂР°С†РёСЏ `005_seed_example_events.sql` вЂ” РІСЃС‚Р°РІРєР° 5 РґРµРјРѕ-СЃРѕР±С‹С‚РёР№ РґР»СЏ РіРѕСЂРѕРґР° spb (group_run, training, club_event), РґР°С‚С‹ РІ Р±СѓРґСѓС‰РµРј, РєРѕРѕСЂРґРёРЅР°С‚С‹ РІ РіСЂР°РЅРёС†Р°С… РЎРџР±; РїРѕСЃР»Рµ РїСЂРёРјРµРЅРµРЅРёСЏ РјРёРіСЂР°С†РёРё СЃРїРёСЃРѕРє СЃРѕР±С‹С‚РёР№ Рё РєР°СЂС‚Р° РїРѕРєР°Р·С‹РІР°СЋС‚ РїСЂРёРјРµСЂС‹. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md), [changes/events.md](changes/events.md).
- **Code review вЂ” Р’С‹Р±РѕСЂ РіРѕСЂРѕРґР° Рё РЎРѕР±С‹С‚РёСЏ РґР»СЏ РїСЂРёРјРµСЂР°:** РџСЂРѕРІРµСЂРµРЅР° РєРѕСЂСЂРµРєС‚РЅРѕСЃС‚СЊ СЂРµР°Р»РёР·Р°С†РёРё. Р’РµСЂРёС„РёС†РёСЂРѕРІР°РЅРѕ: (1) Backend `users.routes.ts:87` вЂ” Р·Р°РїРѕР»РЅРµРЅРёРµ `cityName` РёР· РєРѕРЅС„РёРіР° РєРѕСЂСЂРµРєС‚РЅРѕ; (2) РњРёРіСЂР°С†РёСЏ `005_seed_example_events.sql` вЂ” РєРѕР»РѕРЅРєРё СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‚ СЃС…РµРјРµ events, Р·РЅР°С‡РµРЅРёСЏ С‚РёРїРѕРІ/СЃС‚Р°С‚СѓСЃРѕРІ РІР°Р»РёРґРЅС‹, РєРѕРѕСЂРґРёРЅР°С‚С‹ РІ РіСЂР°РЅРёС†Р°С… SPB (lon 29.6вЂ“30.6, lat 59.7вЂ“60.1), UUID РєРѕСЂСЂРµРєС‚РЅС‹Рµ, idempotent С‡РµСЂРµР· `ON CONFLICT`; (3) Mobile `profile_screen.dart` вЂ” fallback Р»РѕРіРёРєР° РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ РіРѕСЂРѕРґР° РєРѕСЂСЂРµРєС‚РЅР° (`cityName ?? cityId ?? l10n.cityNotSelected`); (4) `ProfileModel.cityName` РєРѕСЂСЂРµРєС‚РЅРѕ РїР°СЂСЃРёС‚СЃСЏ РёР· JSON. РћС€РёР±РѕРє РЅРµ РѕР±РЅР°СЂСѓР¶РµРЅРѕ.
- **Code review вЂ” Р—Р°РІРµСЂС€РµРЅРёРµ С‚СЂРµРЅРёСЂРѕРІРєРё:** РџСЂРѕРІРµСЂРµРЅР° СЂРµР°Р»РёР·Р°С†РёСЏ СЌРєСЂР°РЅР° Р·Р°РІРµСЂС€РµРЅРёСЏ РїСЂРѕР±РµР¶РєРё. РќР°Р№РґРµРЅР° Рё РёСЃРїСЂР°РІР»РµРЅР° РѕРґРЅР° РїСЂРѕР±Р»РµРјР°: РІ РјРµС‚РѕРґРµ `_calcCalories()` РЅРµРёСЃРїРѕР»СЊР·СѓРµРјС‹Р№ РїР°СЂР°РјРµС‚СЂ `duration` СѓРґР°Р»С‘РЅ РёР· СЃРёРіРЅР°С‚СѓСЂС‹ (РєР°Р»РѕСЂРёРё СЃС‡РёС‚Р°СЋС‚СЃСЏ С‚РѕР»СЊРєРѕ РїРѕ РґРёСЃС‚Р°РЅС†РёРё ~65 РєРєР°Р»/РєРј). РћСЃС‚Р°Р»СЊРЅР°СЏ СЂРµР°Р»РёР·Р°С†РёСЏ РєРѕСЂСЂРµРєС‚РЅР°: СЂР°СЃС‡С‘С‚С‹ С‚РµРјРїР°, СЃРєРѕСЂРѕСЃС‚Рё, РєР°Р»РѕСЂРёР№; i18n РєР»СЋС‡Рё; layout РєР°СЂС‚РѕС‡РµРє РјРµС‚СЂРёРє. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Р—Р°РІРµСЂС€РµРЅРёРµ С‚СЂРµРЅРёСЂРѕРІРєРё вЂ” СЌРєСЂР°РЅ РєР°Рє РІ С„РёС‚РЅРµСЃ-РїСЂРёР»РѕР¶РµРЅРёРё (mobile):** Р­РєСЂР°РЅ СЂРµР·СѓР»СЊС‚Р°С‚Р° РїСЂРѕР±РµР¶РєРё РїРµСЂРµСЂР°Р±РѕС‚Р°РЅ РїРѕ РѕР±СЂР°Р·С†Сѓ Strava/Nike Run Club. РљР°СЂС‚РѕС‡РєРё РјРµС‚СЂРёРє: РґР»РёС‚РµР»СЊРЅРѕСЃС‚СЊ, РґРёСЃС‚Р°РЅС†РёСЏ, С‚РµРјРї (РјРёРЅ/РєРј), СЃСЂРµРґРЅСЏСЏ СЃРєРѕСЂРѕСЃС‚СЊ (РєРј/С‡), РєР°Р»РѕСЂРёРё (РїСЂРёРјРµСЂРЅР°СЏ РѕС†РµРЅРєР° ~65 РєРєР°Р»/РєРј), РїСѓР»СЊСЃ (placeholder В«вЂ”В» РїРѕРґ Р±СѓРґСѓС‰СѓСЋ Health Connect). Р”РѕР±Р°РІР»РµРЅС‹ helper-РјРµС‚РѕРґС‹ `_formatPace`, `_calcAvgSpeedKmh`, `_calcCalories`, РІРёРґР¶РµС‚ `_buildMetricCard`. i18n: runDuration, runDistance, runPace, runPaceValue, runAvgSpeed, runAvgSpeedValue, runCalories, runCaloriesValue, runHeartRate, runHeartRateValue, runNoData. Backend Р±РµР· РёР·РјРµРЅРµРЅРёР№. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **РЈРґР°Р»РµРЅРёРµ С‡Р°С‚Р° РіРѕСЂРѕРґР° (backend + mobile):** РЈРґР°Р»С‘РЅ РіРѕСЂРѕРґСЃРєРѕР№ С‡Р°С‚. Backend: СѓРґР°Р»РµРЅС‹ СЌРЅРґРїРѕРёРЅС‚С‹ GET/POST `/api/messages/global`, WebSocket РїРѕРґРґРµСЂР¶РёРІР°РµС‚ С‚РѕР»СЊРєРѕ РєР°РЅР°Р»С‹ `club:{clubId}`. Mobile: СѓРґР°Р»РµРЅС‹ GlobalChatTab, NotificationsTab (orphaned), ChatRealtimeService (orphaned, РёСЃРїРѕР»СЊР·РѕРІР°Р» city-РєР°РЅР°Р»С‹); РІРєР»Р°РґРєРё Р·Р°РјРµРЅРµРЅС‹ РЅР° В«Р›РёС‡РЅС‹РµВ» / В«РљР»СѓР±В» / В«РўСЂРµРЅРµСЂВ» (Р›РёС‡РЅС‹Рµ Рё РўСЂРµРЅРµСЂ вЂ” Р·Р°РіР»СѓС€РєРё); СѓРґР°Р»РµРЅС‹ РјРµС‚РѕРґС‹ getGlobalChatMessages/sendGlobalMessage. Р”РѕР±Р°РІР»РµРЅС‹ l10n РєР»СЋС‡Рё tabPersonal, tabClub, tabCoach, cityLabel, personalChatsEmpty, coachMessagesEmpty; СѓРґР°Р»РµРЅС‹ tabCity, tabClubs, tabNotifications, globalChatEmpty (РєР»СЋС‡Рё noNotifications, notificationsLoadError РѕСЃС‚Р°Р»РёСЃСЊ РґР»СЏ ProfileNotificationsSection). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **Р РµРґР°РєС‚РёСЂРѕРІР°РЅРёРµ РїСЂРѕС„РёР»СЏ (backend + mobile):** Р РµР°Р»РёР·РѕРІР°РЅ СЌРєСЂР°РЅ/С„РѕСЂРјР° РёР·РјРµРЅРµРЅРёСЏ РґР°РЅРЅС‹С… РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ. Backend: РІ `UpdateProfileDto` Рё `UpdateProfileSchema` РґРѕР±Р°РІР»РµРЅС‹ РѕРїС†РёРѕРЅР°Р»СЊРЅС‹Рµ РїРѕР»СЏ `name` (РЅРµРїСѓСЃС‚Р°СЏ СЃС‚СЂРѕРєР°, РјР°РєСЃ. 100 СЃРёРјРІРѕР»РѕРІ) Рё `avatarUrl` (URL РёР»Рё РїСѓСЃС‚Р°СЏ СЃС‚СЂРѕРєР° РґР»СЏ СЃР±СЂРѕСЃР°); РѕР±СЂР°Р±РѕС‚С‡РёРє PATCH `/api/users/me/profile` РїРµСЂРµРґР°С‘С‚ РІ `usersRepo.update()` РїРµСЂРµРґР°РЅРЅС‹Рµ РІ С‚РµР»Рµ `name` Рё `avatarUrl`. Mobile: СЂР°СЃС€РёСЂРµРЅ `UsersService.updateProfile(currentCityId?, name?, avatarUrl?)`; РґРѕР±Р°РІР»РµРЅ СЌРєСЂР°РЅ `EditProfileScreen` (С„РѕСЂРјР°: РёРјСЏ, URL С„РѕС‚Рѕ, РєРЅРѕРїРєР° В«РЎРѕС…СЂР°РЅРёС‚СЊВ»); РІ ProfileScreen вЂ” РєРЅРѕРїРєР° В«Р РµРґР°РєС‚РёСЂРѕРІР°С‚СЊВ» РІ AppBar, РїРµСЂРµС…РѕРґ РЅР° `/profile/edit` СЃ РїРµСЂРµРґР°С‡РµР№ `profile.user` С‡РµСЂРµР· `extra`; РјР°СЂС€СЂСѓС‚ `/profile/edit` РІ `app.dart`; l10n РєР»СЋС‡Рё `editProfileTitle`, `editProfileName`, `editProfilePhotoUrl`, `editProfileSave`, `editProfileNameRequired`, `editProfileEditAction` (en/ru). Р“РѕСЂРѕРґ РїРѕ-РїСЂРµР¶РЅРµРјСѓ СЂРµРґР°РєС‚РёСЂСѓРµС‚СЃСЏ РёР· РѕСЃРЅРѕРІРЅРѕР№ РєР°СЂС‚РѕС‡РєРё РїСЂРѕС„РёР»СЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md).

- **РџРѕР»РµРІРѕРµ С‚РµСЃС‚РёСЂРѕРІР°РЅРёРµ вЂ” РїСЂРѕР±Р»РµРјС‹ СЃ РїСЂРѕР±РµР¶РєРѕР№ Рё СѓС‡Р°СЃС‚РёРµ РІ Р°РєС‚РёРІРЅРѕСЃС‚СЏС…:** РџРѕР»СѓС‡РµРЅ С„РёРґР±РµРє С‚РµСЃС‚РёСЂРѕРІС‰РёРєР°: (1) РїРѕРІС‚РѕСЂРЅС‹Р№ Р·Р°РїСѓСЃРє РїСЂРѕР±РµР¶РєРё РїСЂРёРІРѕРґРёС‚ Рє РѕС€РёР±РєРµ `Exception: Run already started` РїСЂРё С‚РѕРј, С‡С‚Рѕ СЌРєСЂР°РЅ РІС‹РіР»СЏРґРёС‚ РєР°Рє idle (СЃРј. `docs/errors-runbook.md`, СЂР°Р·РґРµР» В«РР·РІРµСЃС‚РЅС‹Рµ РѕС‚РєСЂС‹С‚С‹РµВ»); (2) РІРѕ РІСЂРµРјСЏ РїСЂРѕР±РµР¶РєРё РЅР° РєР°СЂС‚Рµ РјРѕР¶РµС‚ РЅРµ РѕС‚РѕР±СЂР°Р¶Р°С‚СЊСЃСЏ РјР°СЂС€СЂСѓС‚, С…РѕС‚СЏ РїРѕСЃР»Рµ Р·Р°РІРµСЂС€РµРЅРёСЏ СЃРµСЃСЃРёРё РґР°РЅРЅС‹Рµ РїРѕСЏРІР»СЏСЋС‚СЃСЏ; (3) РґР»СЏ СЃРѕР±С‹С‚РёР№ Рё РєР»СѓР±РѕРІ РєРЅРѕРїРєРё В«РџСЂРёСЃРѕРµРґРёРЅРёС‚СЊСЃСЏВ» Рё С„РёР»СЊС‚СЂ В«РњРѕР№ РєР»СѓР±В» РїРѕРєР° РЅРµ СЂР°Р±РѕС‚Р°СЋС‚, СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‰РёРµ РјРµС‚РѕРґС‹ РІ `EventsService` Рё С„РёР»СЊС‚СЂ РїРѕ clubId РІ `MapFilters` РїРѕРјРµС‡РµРЅС‹ TODO/placeholder. РћС€РёР±РєРё backend РІ Р»РѕРіР°С… Р·Р° РґРµРЅСЊ РѕС‚СЃСѓС‚СЃС‚РІСѓСЋС‚, РїСЂРѕР±Р»РµРјС‹ РЅР°С…РѕРґСЏС‚СЃСЏ РЅР° СЃС‚РѕСЂРѕРЅРµ mobile Рё РЅРµРїРѕР»РЅРѕР№ СЂРµР°Р»РёР·Р°С†РёРё С„РёС‡.

- **РћС‚РєСЂС‹С‚С‹Рµ С„РёС‡Рё (infra/README.md) вЂ” СЂРµР°Р»РёР·Р°С†РёСЏ:** Р РµР°Р»РёР·РѕРІР°РЅС‹ С‚СЂРё Р±Р»РѕРєР° РёР· СЂР°Р·РґРµР»Р° В«РћС‚РєСЂС‹С‚С‹Рµ С„РёС‡РёВ». (1) **РЎРѕР±С‹С‚РёСЏ (join/check-in):** Backend: `POST /api/events/:id/join` Рё `POST /api/events/:id/check-in` Р±РµСЂСѓС‚ userId РёР· auth (Firebase UID в†’ users.id С‡РµСЂРµР· `findByFirebaseUid`), РѕС€РёР±РєРё РІРѕР·РІСЂР°С‰Р°СЋС‚СЃСЏ РІ С„РѕСЂРјР°С‚Рµ ADR-0002 `{ code, message, details? }`. Mobile: СЂРµР°Р»РёР·РѕРІР°РЅС‹ `EventsService.joinEvent(eventId)` Рё `checkInEvent(eventId, longitude, latitude)` (POST РЅР° backend, СЂР°Р·Р±РѕСЂ РѕС€РёР±РѕРє С‡РµСЂРµР· ApiException); РЅР° EventDetailsScreen РєРЅРѕРїРєР° В«РџСЂРёСЃРѕРµРґРёРЅРёС‚СЊСЃСЏВ» РІС‹Р·С‹РІР°РµС‚ joinEvent, РїСЂРё СѓСЃРїРµС…Рµ вЂ” РїРµСЂРµР·Р°РіСЂСѓР·РєР° СЃРѕР±С‹С‚РёСЏ Рё SnackBar В«Р’С‹ Р·Р°РїРёСЃР°РЅС‹В», РїСЂРё РѕС€РёР±РєРµ вЂ” SnackBar СЃ СЃРѕРѕР±С‰РµРЅРёРµРј; РґРѕР±Р°РІР»РµРЅС‹ i18n РєР»СЋС‡Рё eventJoinSuccess, eventJoinError, eventCheckInSuccess, eventCheckInError. (2) **РљР»СѓР±С‹ (РїСЂРёСЃРѕРµРґРёРЅРµРЅРёРµ Рє РєР»СѓР±Сѓ):** Backend: РјРёРіСЂР°С†РёСЏ `006_club_members.sql` (С‚Р°Р±Р»РёС†Р° club_members), СЂРµРїРѕР·РёС‚РѕСЂРёР№ ClubMembersRepository, СЌРЅРґРїРѕРёРЅС‚ `POST /api/clubs/:id/join` (auth, РїСЂРѕРІРµСЂРєР° РґСѓР±Р»РёРєР°С‚Р°, РІСЃС‚Р°РІРєР°), РѕС‚РІРµС‚ 201 СЃ membership; `GET /api/clubs/:id` РїСЂРё РЅР°Р»РёС‡РёРё auth РІРѕР·РІСЂР°С‰Р°РµС‚ isMember Рё membershipStatus. Mobile: `ClubsService.joinClub(clubId)`, ClubModel СЂР°СЃС€РёСЂРµРЅ РїРѕР»СЏРјРё isMember Рё membershipStatus; РЅР° ClubDetailsScreen РєРЅРѕРїРєР° В«РџСЂРёСЃРѕРµРґРёРЅРёС‚СЊСЃСЏВ» Рё СЃРѕСЃС‚РѕСЏРЅРёРµ В«Р’С‹ РІ РєР»СѓР±РµВ» РїСЂРё isMember; i18n: clubJoin, clubJoinSuccess, clubJoinError, clubYouAreMember. (3) **Р¤РёР»СЊС‚СЂ В«РњРѕР№ РєР»СѓР±В»:** Backend: РІ GET `/api/users/me/profile` РґРѕР±Р°РІР»РµРЅРѕ РїРѕР»Рµ user.primaryClubId (РёР· club_members). Mobile: CurrentClubService (РёСЃС‚РѕС‡РЅРёРє РїСЂР°РІРґС‹ РґР»СЏ С‚РµРєСѓС‰РµРіРѕ РєР»СѓР±Р°), СЃРёРЅС…СЂРѕРЅРёР·Р°С†РёСЏ СЃ РїСЂРѕС„РёР»РµРј РїСЂРё init(); ProfileUserData.primaryClubId; РЅР° EventsScreen РґРѕР±Р°РІР»РµРЅ С‡РёРї В«РњРѕР№ РєР»СѓР±В» (filtersMyClub), РїСЂРё РІС‹Р±РѕСЂРµ РїРѕРґСЃС‚Р°РІР»СЏРµС‚СЃСЏ clubId РёР· CurrentClubService Рё РїРµСЂРµР·Р°РїСЂР°С€РёРІР°РµС‚СЃСЏ СЃРїРёСЃРѕРє СЃРѕР±С‹С‚РёР№; РїРѕСЃР»Рµ СѓСЃРїРµС€РЅРѕРіРѕ РїСЂРёСЃРѕРµРґРёРЅРµРЅРёСЏ Рє РєР»СѓР±Сѓ РІС‹Р·С‹РІР°РµС‚СЃСЏ setCurrentClubId. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md), [changes/clubs.md](changes/clubs.md), [changes/users.md](changes/users.md), [changes/maps.md](changes/maps.md).

### 2026-02-03
- **Fix: СЌРєСЂР°РЅ СЂРµР·СѓР»СЊС‚Р°С‚Р° РїСЂРѕР±РµР¶РєРё (mobile):** РСЃРїСЂР°РІР»РµРЅ СЂР°СЃС‡С‘С‚ С‚РµРјРїР°, С‡С‚РѕР±С‹ РЅРµ РїРѕР»СѓС‡Р°С‚СЊ С„РѕСЂРјР°С‚ РІРёРґР° `m:60` РїСЂРё РѕРєСЂСѓРіР»РµРЅРёРё; РїСЂРё РѕС€РёР±РєРµ РѕС‚РїСЂР°РІРєРё РїСЂРѕР±РµР¶РєРё UI РІСЃС‘ СЂР°РІРЅРѕ РїРµСЂРµРІРѕРґРёС‚СЃСЏ РІ СЃРѕСЃС‚РѕСЏРЅРёРµ `completed` РїРѕСЃР»Рµ `stopRun()` (РѕС€РёР±РєР° РѕС‚РѕР±СЂР°Р¶Р°РµС‚СЃСЏ С‡РµСЂРµР· SnackBar), С„Р»Р°Рі `_isSubmitting` СЃР±СЂР°СЃС‹РІР°РµС‚СЃСЏ РІ `finally`. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).

### 2026-02-02
- **Fix: POST "/" в†’ 404/400 (РѕР±СЂР°Р±РѕС‚РєР° РЅР° backend + mobile):** (1) Backend: РґРѕР±Р°РІР»РµРЅ 404-РѕР±СЂР°Р±РѕС‚С‡РёРє РґР»СЏ РЅРµРёР·РІРµСЃС‚РЅС‹С… РјР°СЂС€СЂСѓС‚РѕРІ РІ `app.ts` вЂ” РІРѕР·РІСЂР°С‰Р°РµС‚ `{ code: "not_found", message: "Route not found: METHOD /path" }`; РёСЃРїСЂР°РІР»РµРЅ С„РѕСЂРјР°С‚ РѕС€РёР±РєРё 500 СЃ `{ error }` РЅР° `{ code, message }` (ADR-0002). (2) Mobile: РїРѕРґС‚РІРµСЂР¶РґРµРЅРѕ вЂ” `RunService.submitRun()` СѓР¶Рµ РёСЃРїРѕР»СЊР·СѓРµС‚ РєРѕСЂСЂРµРєС‚РЅС‹Р№ РїСѓС‚СЊ `POST /api/runs`; СѓР»СѓС‡С€РµРЅР° РѕР±СЂР°Р±РѕС‚РєР° РѕС€РёР±РѕРє вЂ” РїСЂРё 400/404 РїР°СЂСЃРёС‚СЃСЏ СЃС‚СЂСѓРєС‚СѓСЂРёСЂРѕРІР°РЅРЅС‹Р№ РѕС‚РІРµС‚ backend (`{ code, message }`) Рё РІС‹Р±СЂР°СЃС‹РІР°РµС‚СЃСЏ `ApiException`; РІ `RunScreen` РїСЂРё `ApiException` РїРѕРєР°Р·С‹РІР°РµС‚СЃСЏ `message` РёР· РѕС‚РІРµС‚Р° РІРјРµСЃС‚Рѕ `e.toString()`. (3) РўРµСЃС‚С‹: РѕР±РЅРѕРІР»С‘РЅ `app.test.ts` вЂ” РїСЂРѕРІРµСЂРєР° 404 РІРєР»СЋС‡Р°РµС‚ С‚РµР»Рѕ `{ code, message }`; РґРѕР±Р°РІР»РµРЅ С‚РµСЃС‚ POST "/" в†’ 404. Р’СЃРµ 55 С‚РµСЃС‚РѕРІ РїСЂРѕС…РѕРґСЏС‚. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Fix: GET /api/map/data в†’ 401 (РѕР±СЂР°Р±РѕС‚РєР° РЅР° mobile):** РІ `MapService.getMapData()` РґРѕР±Р°РІР»РµРЅРѕ СЏРІРЅРѕРµ СЂР°СЃРїРѕР·РЅР°РІР°РЅРёРµ 401 (`ApiException('unauthorized', ...)`); РІ `MapScreen._loadMapData()` РїСЂРё 401 вЂ” РїРѕРїС‹С‚РєР° РѕР±РЅРѕРІРёС‚СЊ С‚РѕРєРµРЅ (`ServiceLocator.refreshAuthToken()`) Рё РїРѕРІС‚РѕСЂРЅС‹Р№ Р·Р°РїСЂРѕСЃ; РїСЂРё РїРѕРІС‚РѕСЂРЅРѕРј 401 вЂ” СЂРµРґРёСЂРµРєС‚ РЅР° СЌРєСЂР°РЅ РІС…РѕРґР° (`context.go('/login')`). Backend РЅРµ РёР·РјРµРЅС‘РЅ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/maps.md](changes/maps.md).
- **Verified: GET /api/messages/global в†’ 400 (РЅРµС‚ cityId) вЂ” СѓР¶Рµ РёСЃРїСЂР°РІР»РµРЅРѕ:** mobile (`global_chat_tab.dart`) РЅРµ РІС‹Р·С‹РІР°РµС‚ `/api/messages/global` Р±РµР· `cityId` вЂ” РїСЂРѕРІРµСЂСЏРµС‚ РЅР°Р»РёС‡РёРµ РіРѕСЂРѕРґР° РїРµСЂРµРґ Р·Р°РїСЂРѕСЃРѕРј, РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РїРѕРєР°Р·С‹РІР°РµС‚ СЌРєСЂР°РЅ В«РЈРєР°Р¶РёС‚Рµ РіРѕСЂРѕРґВ». Backend РІР°Р»РёРґР°С†РёСЏ (400 РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё cityId) РєРѕСЂСЂРµРєС‚РЅР°. РћС€РёР±РєРё 400 РІ Р»РѕРіР°С… вЂ” РѕС‚ СЃС‚Р°СЂС‹С… РєР»РёРµРЅС‚РѕРІ РґРѕ РїСЂРёРјРµРЅРµРЅРёСЏ С„РёРєСЃР°.
- **Fix: GET /api/me/profile в†’ 401 (РїРѕС‚РµСЂСЏ Authorization РїСЂРё 302-СЂРµРґРёСЂРµРєС‚Рµ):** Р°Р»РёР°СЃ GET `/api/me/profile` Р·Р°РјРµРЅС‘РЅ СЃ 302-СЂРµРґРёСЂРµРєС‚Р° РЅР° РїСЂСЏРјРѕР№ forward Р·Р°РїСЂРѕСЃР° РІ `usersRouter`. 302-СЂРµРґРёСЂРµРєС‚ С‚РµСЂСЏР» Р·Р°РіРѕР»РѕРІРѕРє `Authorization`, РёР·-Р·Р° С‡РµРіРѕ РєР»РёРµРЅС‚С‹, Р·Р°РїСЂР°С€РёРІР°СЋС‰РёРµ `/api/me/profile`, РїРѕР»СѓС‡Р°Р»Рё 401. РўРµРїРµСЂСЊ РѕР±Р° РїСѓС‚Рё (`/api/me/profile` Рё `/api/users/me/profile`) РѕР±СЂР°Р±Р°С‚С‹РІР°СЋС‚СЃСЏ РѕРґРЅРёРј handler. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md).
- **Code review вЂ” 3 Р±Р°РіР° РІ РёР·РјРµРЅС‘РЅРЅРѕРј РєРѕРґРµ:** (1) `run_service.dart` вЂ” GPS-С‚РѕС‡РєРё РІ `submitRun()` РѕС‚РїСЂР°РІР»СЏР»РёСЃСЊ СЃ РїРѕР»СЏРјРё `lat`/`lon`, РЅРѕ backend (`GpsPointSchema` РёР· `GeoCoordinatesSchema`) РѕР¶РёРґР°РµС‚ `latitude`/`longitude`; Zod-РІР°Р»РёРґР°С†РёСЏ РѕС‚РєР»РѕРЅСЏР»Р° GPS-РґР°РЅРЅС‹Рµ в†’ РёСЃРїСЂР°РІР»РµРЅС‹ РёРјРµРЅР° РїРѕР»РµР№. (2) `global_chat_tab.dart` вЂ” fallback `'spb'` РІ cityId РїСЂРёРІРѕРґРёР» Рє РІС‹Р·РѕРІСѓ messages API РґР°Р¶Рµ РєРѕРіРґР° РіРѕСЂРѕРґ РЅРµ СѓСЃС‚Р°РЅРѕРІР»РµРЅ (noCitySet); СѓР±СЂР°РЅ fallback, РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РіРѕСЂРѕРґР° API РЅРµ РІС‹Р·С‹РІР°РµС‚СЃСЏ, СЃСЂР°Р·Сѓ РїРѕРєР°Р·С‹РІР°РµС‚СЃСЏ РїРѕРґСЃРєР°Р·РєР° В«РЈРєР°Р¶РёС‚Рµ РіРѕСЂРѕРґВ». (3) `users.routes.ts` вЂ” СЃС‚Р°СЂС‹Рµ СЌРЅРґРїРѕРёРЅС‚С‹ (GET /, GET /:id, POST /, DELETE /me) РІРѕР·РІСЂР°С‰Р°Р»Рё РѕС€РёР±РєРё РІ С„РѕСЂРјР°С‚Рµ `{ error }` РІРјРµСЃС‚Рѕ РµРґРёРЅРѕРіРѕ `{ code, message }` (ADR-0002); РїСЂРёРІРµРґРµРЅС‹ Рє РµРґРёРЅРѕРјСѓ С„РѕСЂРјР°С‚Сѓ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md), [changes/messages.md](changes/messages.md), [changes/users.md](changes/users.md).
- **РСЃРїСЂР°РІР»РµРЅРёСЏ РїРѕ Р»РѕРіР°Рј Рё РІС‹Р±РѕСЂ РіРѕСЂРѕРґР° РІ РїСЂРѕС„РёР»Рµ:** (1) РћС€РёР±РєР° СЃРѕР·РґР°РЅРёСЏ run (500, PostgreSQL 22P02): РІ `runs.routes.ts` userId Р±РµСЂС‘С‚СЃСЏ С‚РѕР»СЊРєРѕ РёР· Р°РІС‚РѕСЂРёР·Р°С†РёРё (`req.authUser.uid` в†’ `findByFirebaseUid`); РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РёР»Рё РЅРµРІР°Р»РёРґРЅРѕРј UUID РІРѕР·РІСЂР°С‰Р°РµС‚СЃСЏ 400 РІ С„РѕСЂРјР°С‚Рµ API (validation_error / Authentication required). (2) РџСѓС‚СЊ СЃРѕР·РґР°РЅРёСЏ РїСЂРѕР±РµР¶РєРё РЅР° РєР»РёРµРЅС‚Рµ РїРѕРґС‚РІРµСЂР¶РґС‘РЅ: POST `/api/runs` РІ `run_service.dart`, РґРѕР±Р°РІР»РµРЅ РєРѕРјРјРµРЅС‚Р°СЂРёР№ Рѕ РєР°РЅРѕРЅРёС‡РµСЃРєРѕРј РїСѓС‚Рё. (3) GET `/api/messages/global`: РѕР±СЏР·Р°С‚РµР»СЊРЅС‹Р№ query-РїР°СЂР°РјРµС‚СЂ `cityId`; РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё вЂ” 400 СЃ СЃРѕРѕР±С‰РµРЅРёРµРј В«cityId is requiredВ»; mobile РїРµСЂРµРґР°С‘С‚ `cityId` РІ `getGlobalChatMessages`, РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РіРѕСЂРѕРґР° РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РґРµС„РѕР»С‚ `spb`. (4) Р•РґРёРЅС‹Р№ РїСѓС‚СЊ РїСЂРѕС„РёР»СЏ: РґРѕР±Р°РІР»РµРЅ Р°Р»РёР°СЃ GET `/api/me/profile` в†’ СЂРµРґРёСЂРµРєС‚ 302 РЅР° `/api/users/me/profile`. (5) Р’С‹Р±РѕСЂ РіРѕСЂРѕРґР° РІ Р»РёС‡РЅРѕРј РєР°Р±РёРЅРµС‚Рµ: РјРёРіСЂР°С†РёСЏ `004_users_city_id_varchar` (users.city_id UUIDв†’VARCHAR(64)); PATCH `/api/users/me/profile` СЃ С‚РµР»РѕРј `{ currentCityId? }`; РІ `users.routes` РІРµР·РґРµ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ `req.authUser.uid`; mobile: Р±Р»РѕРє В«Р“РѕСЂРѕРґВ» РІ ProfileScreen, РґРёР°Р»РѕРі РІС‹Р±РѕСЂР° РіРѕСЂРѕРґР°, `UsersService.updateProfile`, `ApiClient.patch`, СЃРѕС…СЂР°РЅРµРЅРёРµ РІ CurrentCityService Рё РЅР° backend; l10n РєР»СЋС‡ `cityNotSelected`. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md), [changes/users.md](changes/users.md), [changes/messages.md](changes/messages.md), [changes/cities.md](changes/cities.md).
- **Code review вЂ” РёСЃРїСЂР°РІР»РµРЅРёРµ РѕС€РёР±РѕРє РІ РјСѓР»СЊС‚Рё-РіРѕСЂРѕРґ РєРѕРјРјРёС‚Рµ:** 5 РёСЃРїСЂР°РІР»РµРЅРёР№: (1) `events.repository.ts` вЂ” `|| undefined` Р·Р°РјРµРЅС‘РЅ РЅР° `?? undefined` РґР»СЏ `participantLimit`, `checkInLongitude`, `checkInLatitude` (Р±Р°Рі: Р·РЅР°С‡РµРЅРёРµ `0` РїСЂРµРѕР±СЂР°Р·РѕРІС‹РІР°Р»РѕСЃСЊ РІ `undefined`); (2) `city_picker_dialog.dart` вЂ” 4 С…Р°СЂРґРєРѕРґ-СЃС‚СЂРѕРєРё РЅР° СЂСѓСЃСЃРєРѕРј Р·Р°РјРµРЅРµРЅС‹ РЅР° РІС‹Р·РѕРІС‹ `AppLocalizations` (РґРѕР±Р°РІР»РµРЅС‹ РєР»СЋС‡Рё `cityPickerTitle`, `cityPickerLoadError`, `cityPickerEmpty` РІ ARB Рё СЃРіРµРЅРµСЂРёСЂРѕРІР°РЅРЅС‹Рµ l10n-С„Р°Р№Р»С‹); (3) `territories.routes.ts` вЂ” mock `cityId: 'city-1'` Р·Р°РјРµРЅС‘РЅ РЅР° `'spb'` РґР»СЏ СЃРѕРіР»Р°СЃРѕРІР°РЅРЅРѕСЃС‚Рё СЃ РєРѕРЅС„РёРіРѕРј РіРѕСЂРѕРґРѕРІ; (4) `event_list_item_model_test.dart` вЂ” РґРѕР±Р°РІР»РµРЅ `cityId` РІ С‚РµСЃС‚РѕРІС‹Рµ JSON Рё РїСЂРѕРІРµСЂРєРё (РїРѕРєСЂС‹С‚РёРµ РЅРѕРІРѕРіРѕ РїРѕР»СЏ); (5) `map_screen.dart` вЂ” СѓРґР°Р»С‘РЅ `DevRemoteLogger.logError` РґР»СЏ С€С‚Р°С‚РЅРѕРіРѕ СЃРѕР±С‹С‚РёСЏ `onMapCreated` (РѕС€РёР±РѕС‡РЅРѕРµ РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ error-Р»РѕРіРіРµСЂР° РґР»СЏ info-СЃРѕРѕР±С‰РµРЅРёСЏ). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/cities.md](changes/cities.md).
- **Code review fix вЂ” РїСЂРѕРїСѓС‰РµРЅРЅС‹Рµ i18n СЃС‚СЂРѕРєРё Рё deprecated API:** РёСЃРїСЂР°РІР»РµРЅС‹ 6 С…Р°СЂРґРєРѕРґ-СЃС‚СЂРѕРє РЅР° СЂСѓСЃСЃРєРѕРј, РѕСЃС‚Р°РІС€РёС…СЃСЏ РїРѕСЃР»Рµ i18n-РјРёРіСЂР°С†РёРё: `login_screen.dart` (РѕС€РёР±РєР° РІС…РѕРґР°), `run_screen.dart` (С‚РµРєСЃС‚ РїСЂРёРІСЏР·РєРё Рє С‚СЂРµРЅРёСЂРѕРІРєРµ, РєРЅРѕРїРєР° В«РќР°С‡Р°С‚СЊ РїСЂРѕР±РµР¶РєСѓВ»), `settings_section.dart` (В«Р’С‹Р№С‚Рё РёР· Р°РєРєР°СѓРЅС‚Р°В»), `club_details_screen.dart` (Р·Р°РіРѕР»РѕРІРѕРє В«РљР»СѓР±В»), `territory_details_screen.dart` (РїРѕРґРїРёСЃСЊ В«РЎС‚Р°С‚СѓСЃВ»). Р—Р°РјРµРЅРµРЅС‹ РЅР° РІС‹Р·РѕРІС‹ `AppLocalizations.of(context)!` СЃ СЃСѓС‰РµСЃС‚РІСѓСЋС‰РёРјРё РєР»СЋС‡Р°РјРё РёР· ARB. РўР°РєР¶Рµ РёСЃРїСЂР°РІР»РµРЅС‹ 3 РѕСЃС‚Р°РІС€РёС…СЃСЏ РІС‹Р·РѕРІР° deprecated `withOpacity()` в†’ `Color.fromRGBO()` РІ `events/widgets/event_card.dart`, `map/widgets/event_card.dart`, `activity_section.dart`. Р”РѕР±Р°РІР»РµРЅ РїСЂРѕРїСѓС‰РµРЅРЅС‹Р№ `const` РІ `global_chat_tab.dart`. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/i18n.md](changes/i18n.md).
- **i18n вЂ” Р»РѕРєР°Р»РёР·Р°С†РёСЏ СЃС‚СЂРѕРє (mobile):** РІРЅРµРґСЂРµРЅР° Р»РѕРєР°Р»РёР·Р°С†РёСЏ РІ РјРѕР±РёР»СЊРЅРѕРј РїСЂРёР»РѕР¶РµРЅРёРё: Р·Р°РІРёСЃРёРјРѕСЃС‚СЊ `flutter_localizations`, РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ l10n (`l10n.yaml`), ARB-С„Р°Р№Р»С‹ `app_en.arb` Рё `app_ru.arb` РІ `mobile/l10n/`, РіРµРЅРµСЂР°С†РёСЏ `AppLocalizations` РІ `lib/l10n/`. Р’ `MaterialApp.router` РґРѕР±Р°РІР»РµРЅС‹ `localizationsDelegates`, `supportedLocales`, `localeResolutionCallback` (fallback РЅР° `ru`). Р’СЃРµ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊСЃРєРёРµ СЃС‚СЂРѕРєРё РІ СЌРєСЂР°РЅР°С… Рё РІРёРґР¶РµС‚Р°С… Р·Р°РјРµРЅРµРЅС‹ РЅР° РІС‹Р·РѕРІС‹ `AppLocalizations.of(context)!`. РџРѕРґРґРµСЂР¶РёРІР°РµРјС‹Рµ Р»РѕРєР°Р»Рё: СЂСѓСЃСЃРєРёР№ (ru), Р°РЅРіР»РёР№СЃРєРёР№ (en). РЎРѕРѕР±С‰РµРЅРёСЏ РѕР± РѕС€РёР±РєР°С… (С‚Р°Р№РјР°СѓС‚, СЃРµС‚СЊ, РіРµРѕР»РѕРєР°С†РёСЏ, РїСЂРѕР±РµР¶РєР°) Рё РєРѕРґС‹ API Р»РѕРєР°Р»РёР·СѓСЋС‚СЃСЏ РЅР° РєР»РёРµРЅС‚Рµ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/i18n.md](changes/i18n.md).
- **Background GPS вЂ” С‚СЂРµРєРёРЅРі РїСЂРѕР±РµР¶РєРё РІ С„РѕРЅРµ (РёСЃРїСЂР°РІР»РµРЅ):** РїР°РєРµС‚ `background_location:0.13.2` РёСЃРїРѕР»СЊР·СѓРµС‚ СѓСЃС‚Р°СЂРµРІС€РёР№ Flutter plugin embedding v1 (`Registrar`) Рё РЅРµ РєРѕРјРїРёР»РёСЂСѓРµС‚СЃСЏ СЃ С‚РµРєСѓС‰РµР№ РІРµСЂСЃРёРµР№ Flutter. Р—Р°РјРµРЅС‘РЅ РЅР° РІСЃС‚СЂРѕРµРЅРЅС‹Р№ foreground service geolocator_android (`AndroidSettings.foregroundNotificationConfig`): РїСЂРё `startTracking(background: true)` geolocator СЃС‚Р°СЂС‚СѓРµС‚ foreground service СЃ СѓРІРµРґРѕРјР»РµРЅРёРµРј В«Runterra вЂ” Run in progressВ», GPS-С‚СЂРµРєРёРЅРі РїСЂРѕРґРѕР»Р¶Р°РµС‚СЃСЏ РїСЂРё СЃРІРѕСЂР°С‡РёРІР°РЅРёРё РїСЂРёР»РѕР¶РµРЅРёСЏ. РЈРґР°Р»РµРЅС‹: Р·Р°РІРёСЃРёРјРѕСЃС‚СЊ background_location РёР· pubspec.yaml, РїСЂРёРІР°С‚РЅС‹Р№ РјРµС‚РѕРґ `_locationToPosition`, С„Р»Р°Рі `_isBackgroundTracking`. Р Р°Р·СЂРµС€РµРЅРёСЏ FOREGROUND_SERVICE, FOREGROUND_SERVICE_LOCATION, ACCESS_BACKGROUND_LOCATION, POST_NOTIFICATIONS РІ AndroidManifest СЃРѕС…СЂР°РЅРµРЅС‹. `compileSdk` РїРѕРґРЅСЏС‚ СЃ 35 РґРѕ 36 (С‚СЂРµР±РѕРІР°РЅРёРµ geolocator_android, google_sign_in_android, flutter_plugin_android_lifecycle). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Р§Р°С‚ вЂ” real-time СЃРѕРѕР±С‰РµРЅРёСЏ:** СЂРµР°Р»РёР·РѕРІР°РЅР° РґРѕСЃС‚Р°РІРєР° СЃРѕРѕР±С‰РµРЅРёР№ РІ СЂРµР°Р»СЊРЅРѕРј РІСЂРµРјРµРЅРё РґР»СЏ РіРѕСЂРѕРґСЃРєРѕРіРѕ С‡Р°С‚Р°. Backend: РјРёРіСЂР°С†РёСЏ 002_messages (С‚Р°Р±Р»РёС†Р° messages), РјРѕРґСѓР»СЊ messages (entity, DTO, Zod-СЃС…РµРјР°, СЂРµРїРѕР·РёС‚РѕСЂРёР№), REST API GET/POST /api/messages/global Рё GET/POST /api/messages/clubs/:clubId, WebSocket-СЃРµСЂРІРµСЂ РЅР° РїСѓС‚Рё /ws (auth РїРѕ query token, РїРѕРґРїРёСЃРєР° РЅР° РєР°РЅР°Р»С‹ city:{cityId} Рё club:{clubId}, broadcast РїСЂРё СЃРѕР·РґР°РЅРёРё СЃРѕРѕР±С‰РµРЅРёСЏ). Mobile: Р·Р°РІРёСЃРёРјРѕСЃС‚СЊ web_socket_channel, СЂРµР°Р»РёР·Р°С†РёСЏ getGlobalChatMessages Рё sendGlobalMessage РІ MessagesService, ChatRealtimeService РґР»СЏ РїРѕРґРїРёСЃРєРё РЅР° WebSocket Рё СЃС‚СЂРёРјР° РЅРѕРІС‹С… СЃРѕРѕР±С‰РµРЅРёР№, GlobalChatTab вЂ” Р·Р°РіСЂСѓР·РєР° СЃРїРёСЃРєР° + РїСЂРѕС„РёР»СЊ РґР»СЏ cityId, РїРѕРґРїРёСЃРєР° РЅР° real-time, РїРѕР»Рµ РІРІРѕРґР° Рё РѕС‚РїСЂР°РІРєР° СЃРѕРѕР±С‰РµРЅРёР№. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **Р§Р°С‚ вЂ” РёСЃРїСЂР°РІР»РµРЅРёСЏ РїРѕСЃР»Рµ code review:** РёСЃРїСЂР°РІР»РµРЅ РїРѕСЂСЏРґРѕРє СЃРѕРѕР±С‰РµРЅРёР№ РІ GlobalChatTab (reverse РЅР°С‡Р°Р»СЊРЅРѕР№ Р·Р°РіСЂСѓР·РєРё DESCв†’ASC РґР»СЏ РєРѕСЂСЂРµРєС‚РЅРѕРіРѕ РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ СЃ reverse ListView). Backend WebSocket: uid РёР· С‚РѕРєРµРЅР° СЃРѕС…СЂР°РЅСЏРµС‚СЃСЏ РЅР° СЃРѕРµРґРёРЅРµРЅРёРё, РґРѕР±Р°РІР»РµРЅР° РІР°Р»РёРґР°С†РёСЏ РєР°РЅР°Р»Р° РїСЂРё subscribe (regex С„РѕСЂРјР°С‚Р°, РїСЂРѕРІРµСЂРєР° cityId РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РґР»СЏ city-РєР°РЅР°Р»РѕРІ), РґРѕР±Р°РІР»РµРЅ closeChatWs() РґР»СЏ graceful shutdown. REST API: РґРѕР±Р°РІР»РµРЅР° auth-РїСЂРѕРІРµСЂРєР° РІ GET /clubs/:clubId, РґРѕР±Р°РІР»РµРЅР° parsePagination() СЃ Р·Р°С‰РёС‚РѕР№ РѕС‚ NaN/РѕС‚СЂРёС†Р°С‚РµР»СЊРЅС‹С…/РїСЂРµРІС‹С€Р°СЋС‰РёС… Р»РёРјРёС‚ Р·РЅР°С‡РµРЅРёР№. Mobile: _toWsUrl Р±РѕР»СЊС€Рµ РЅРµ РїСЂРёРІРѕРґРёС‚ РІРµСЃСЊ URL Рє lowercase (С‚РѕР»СЊРєРѕ СЃС…РµРјСѓ). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **Р§Р°С‚ вЂ” fix Unhandled Exception user_city_required (logcat):** РІ GlobalChatTab._fetchData() РїСЂРѕС„РёР»СЊ Р·Р°РіСЂСѓР¶Р°РµС‚СЃСЏ РїРµСЂРІС‹Рј РґР»СЏ РїРѕР»СѓС‡РµРЅРёСЏ cityId; РµСЃР»Рё РіРѕСЂРѕРґ РЅРµ СѓСЃС‚Р°РЅРѕРІР»РµРЅ вЂ” messages API РЅРµ РІС‹Р·С‹РІР°РµС‚СЃСЏ, РІРјРµСЃС‚Рѕ РєСЂР°СЃРЅРѕР№ РѕС€РёР±РєРё РїРѕРєР°Р·С‹РІР°РµС‚СЃСЏ РґСЂСѓР¶РµР»СЋР±РЅС‹Р№ СЌРєСЂР°РЅ В«РЈРєР°Р¶РёС‚Рµ РіРѕСЂРѕРґ РІ РїСЂРѕС„РёР»РµВ» СЃ РєРЅРѕРїРєРѕР№ РїРѕРІС‚РѕСЂР°. РЈСЃС‚СЂР°РЅСЏРµС‚ Unhandled Exception РІ logcat РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё РіРѕСЂРѕРґР° Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **РњСѓР»СЊС‚РёвЂ‘РіРѕСЂРѕРґ Рё РЅРѕСЂРјР°Р»РёР·Р°С†РёСЏ РєР°СЂС‚С‹ (backend + mobile):** РґРѕР±Р°РІР»РµРЅР° РїРѕР»РЅРѕС†РµРЅРЅР°СЏ РјРѕРґРµР»СЊ РіРѕСЂРѕРґР° СЃ С†РµРЅС‚СЂРѕРј Рё РіСЂР°РЅРёС†Р°РјРё (`center`, `bounds`) Рё in-memory РєРѕРЅС„РёРі РіРѕСЂРѕРґРѕРІ (РЎРџР±) РІ backend (РјРѕРґСѓР»СЊ cities), СЂР°СЃС€РёСЂРµРЅС‹ СЃСѓС‰РЅРѕСЃС‚Рё/DTO СЃРѕР±С‹С‚РёР№, РєР»СѓР±РѕРІ Рё С‚РµСЂСЂРёС‚РѕСЂРёР№ РїРѕР»РµРј `cityId`, РґРѕР±Р°РІР»РµРЅР° РјРёРіСЂР°С†РёСЏ `003_events_city_id` Рё С„РёР»СЊС‚СЂР°С†РёСЏ РїРѕ `cityId`/`clubId` РІ `/api/events`, `/api/map/data`, `/api/clubs`, `/api/territories`. РќР° РјРѕР±РёР»СЊРЅРѕРј РєР»РёРµРЅС‚Рµ СЂРµР°Р»РёР·РѕРІР°РЅ `CurrentCityService` (РєРµС€ + РїСЂРѕС„РёР»СЊ), РґРёР°Р»РѕРі РІС‹Р±РѕСЂР° РіРѕСЂРѕРґР°, РїРµСЂРµРґР°С‡Р° `cityId` РІРѕ РІСЃРµ СЂРµР»РµРІР°РЅС‚РЅС‹Рµ API-Р·Р°РїСЂРѕСЃС‹ Рё РЅРѕСЂРјР°Р»РёР·Р°С†РёСЏ РєР°СЂС‚С‹ Yandex MapKit РїРѕРґ РІС‹Р±СЂР°РЅРЅС‹Р№ РіРѕСЂРѕРґ (С†РµРЅС‚СЂ, zoom, РѕРіСЂР°РЅРёС‡РµРЅРёСЏ РѕР±Р»Р°СЃС‚Рё). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/cities.md](changes/cities.md), [changes/events.md](changes/events.md), [changes/clubs.md](changes/clubs.md), [changes/territories.md](changes/territories.md), [changes/maps.md](changes/maps.md).

### 2025-01-27
- **РџРѕР»СЊР·РѕРІР°С‚РµР»Рё / РїСЂРѕС„РёР»СЊ:** РєРѕРЅС‚СЂР°РєС‚ `club === null`, mock-С„Р»Р°Рі РґР»СЏ Р·Р°РіР»СѓС€РµРє, РїСЂР°РІРёР»Р° РјРµСЂРєР°С‚РµР»СЏ, ProfileScreen РєР°Рє С‚РѕС‡РєР° РІС…РѕРґР°. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md).
- **РЎРѕР±С‹С‚РёСЏ (Events) MVP:** Р°СЂС…РёС‚РµРєС‚СѓСЂРЅР°СЏ РѕСЃРЅРѕРІР° РјРѕРґСѓР»СЏ Events (backend + mobile), С‚РёРїС‹, DTO, API СЂРѕСѓС‚РµСЂС‹, UI РєРѕРјРїРѕРЅРµРЅС‚С‹, РёРЅРІР°СЂРёР°РЅС‚С‹ СЃС‚Р°С‚СѓСЃРѕРІ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md).
- **Messages MVP С‚Р°Р±С‹ РїРѕ 123.md:** С‚Р°Р±С‹ В«Р“РѕСЂРѕРґ | РљР»СѓР±С‹ | РЈРІРµРґРѕРјР»РµРЅРёСЏВ», СѓР±СЂР°РЅС‹ Р»РёС‡РЅС‹Рµ РїРµСЂРµРїРёСЃРєРё, РґРѕР±Р°РІР»РµРЅР° РІРєР»Р°РґРєР° СѓРІРµРґРѕРјР»РµРЅРёР№, РѕР±РЅРѕРІР»С‘РЅ empty state РіРѕСЂРѕРґСЃРєРѕРіРѕ С‡Р°С‚Р°. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/messages.md](changes/messages.md).
- **Run Tab MVP:** СЂРµР°Р»РёР·Р°С†РёСЏ MVP РІРєР»Р°РґРєРё Run СЃРѕРіР»Р°СЃРЅРѕ 123.md вЂ” GPS-С‚СЂРµРєРёРЅРі, С‚Р°Р№РјРµСЂ, С‚СЂРё СЃРѕСЃС‚РѕСЏРЅРёСЏ (idle/recording/result), backend РјРѕРґСѓР»СЊ runs, API РґР»СЏ СЃРѕС…СЂР°РЅРµРЅРёСЏ РїСЂРѕР±РµР¶РµРє. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Maps MVP:** Р°СЂС…РёС‚РµРєС‚СѓСЂРЅР°СЏ РѕСЃРЅРѕРІР° РєР°СЂС‚С‹ СЃРѕРіР»Р°СЃРЅРѕ 123.md вЂ” API endpoint РґР»СЏ РґР°РЅРЅС‹С… РєР°СЂС‚С‹, РјРѕРґРµР»Рё, СЃРµСЂРІРёСЃС‹, UI РєРѕРјРїРѕРЅРµРЅС‚С‹ (С‚РµСЂСЂРёС‚РѕСЂРёРё, СЃРѕР±С‹С‚РёСЏ, С„РёР»СЊС‚СЂС‹, РєРЅРѕРїРєР° "РњРѕС‘ РјРµСЃС‚РѕРїРѕР»РѕР¶РµРЅРёРµ"). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/maps.md](changes/maps.md).
- **Р›РѕРіРёСЂРѕРІР°РЅРёРµ РѕС€РёР±РѕРє РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ (Sentry):** РёРЅС‚РµРіСЂР°С†РёСЏ Sentry РґР»СЏ РјРѕРЅРёС‚РѕСЂРёРЅРіР° РѕС€РёР±РѕРє РІ mobile (Flutter) Рё backend (Node.js). РџРµСЂРµС…РІР°С‚ РЅРµРѕР±СЂР°Р±РѕС‚Р°РЅРЅС‹С… РёСЃРєР»СЋС‡РµРЅРёР№, СЏРІРЅР°СЏ РѕС‚РїСЂР°РІРєР° РѕС€РёР±РѕРє РёР· РєР»СЋС‡РµРІС‹С… РјРµСЃС‚. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/logging.md](changes/logging.md), [adr/0001-sentry-error-logging.md](adr/0001-sentry-error-logging.md).
- **РќР°СЃС‚СЂРѕР№РєР° Firebase Authentication РґР»СЏ Android:** РёРЅС‚РµРіСЂР°С†РёСЏ Firebase Authentication РІ РјРѕР±РёР»СЊРЅРѕРµ РїСЂРёР»РѕР¶РµРЅРёРµ вЂ” РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ Firebase РїСЂРѕРµРєС‚Р°, РЅР°СЃС‚СЂРѕР№РєР° Gradle, РґРѕР±Р°РІР»РµРЅРёРµ Р·Р°РІРёСЃРёРјРѕСЃС‚РµР№, РёРЅРёС†РёР°Р»РёР·Р°С†РёСЏ РІ РєРѕРґРµ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/firebase-setup.md](changes/firebase-setup.md), [docs/firebase-setup.md](firebase-setup.md).

### 2026-01-31
- **Smoke-С‚РµСЃС‚С‹ (backend + mobile):** РґРѕР±Р°РІР»РµРЅС‹ Р±Р°Р·РѕРІС‹Рµ С‚РµСЃС‚С‹ РґР»СЏ РєСЂРёС‚РёС‡РЅС‹С… РїСѓС‚РµР№. Backend: Jest + supertest, 18 С‚РµСЃС‚РѕРІ (health endpoint, auth middleware, РІСЃРµ GET /api/*, POST validation). Mobile: flutter_test, 13 С‚РµСЃС‚РѕРІ (РјРѕРґРµР»Рё EventListItemModel, ClubModel, RunModel вЂ” fromJson/toJson, null handling). РљРѕРјР°РЅРґС‹: `npm test` (backend), `flutter test` (mobile).
- **РљРЅРѕРїРєР° РїРѕРІС‚РѕСЂР° РЅР° РІСЃРµС… СЌРєСЂР°РЅР°С… РѕС€РёР±РѕРє:** РґРѕР±Р°РІР»РµРЅ `onRetry` callback РІ `ErrorDisplay`, РІСЃРµ detail screens Рё С‚Р°Р±С‹ СЃРѕРѕР±С‰РµРЅРёР№ РїРѕР»СѓС‡РёР»Рё РІРѕР·РјРѕР¶РЅРѕСЃС‚СЊ РїРµСЂРµР·Р°РіСЂСѓР·РєРё РґР°РЅРЅС‹С… РїСЂРё РѕС€РёР±РєРµ.
- **РњРёРіСЂР°С†РёСЏ РєР°СЂС‚: Mapbox в†’ Yandex MapKit:** С‚РµС…РЅРѕР»РѕРіРёС‡РµСЃРєРёР№ СЃС‚РµРє РєР°СЂС‚ РёР·РјРµРЅС‘РЅ СЃ Mapbox РЅР° Yandex MapKit; РїСЂРёС‡РёРЅР° вЂ” Р»СѓС‡С€Р°СЏ РїРѕРґРґРµСЂР¶РєР° СЂРµРіРёРѕРЅР° Р Р¤ Рё С†РµРЅРѕРІР°СЏ РїРѕР»РёС‚РёРєР°. РћР±РЅРѕРІР»РµРЅС‹: pubspec.yaml (yandex_mapkit: ^4.0.0), AndroidManifest.xml (API РєР»СЋС‡ РЇРЅРґРµРєСЃ), map_screen.dart (РїРѕР»РЅРѕСЃС‚СЊСЋ РїРµСЂРµРїРёСЃР°РЅ РїРѕРґ Yandex API), СѓРґР°Р»С‘РЅ my_location_button.dart (С„СѓРЅРєС†РёРѕРЅР°Р» РІСЃС‚СЂРѕРµРЅ РІ map_screen), РѕР±РЅРѕРІР»РµРЅР° РґРѕРєСѓРјРµРЅС‚Р°С†РёСЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/maps-yandex.md](changes/maps-yandex.md).
- **Mobile API base URL вЂ” РѕР±Р»Р°С‡РЅС‹Р№ backend РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ (debug):** РІ `api_config.dart` РґР»СЏ debug-СЃР±РѕСЂРѕРє РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё `--dart-define=API_BASE_URL` РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РѕР±Р»Р°С‡РЅС‹Р№ backend `http://85.208.85.13:3000` (Cloud.ru); РґР»СЏ release/production РїРѕРІРµРґРµРЅРёРµ Р±РµР· РёР·РјРµРЅРµРЅРёР№ (https). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/api-client.md](changes/api-client.md).

### 2026-01-27
- **Backend dev compile fix (Sentry types):** РґРѕР±Р°РІР»РµРЅС‹ РјРёРЅРёРјР°Р»СЊРЅС‹Рµ TypeScript-С‚РёРїРёР·Р°С†РёРё РґР»СЏ `@sentry/node` РІ backend, С‡С‚РѕР±С‹ СѓСЃС‚СЂР°РЅРёС‚СЊ РѕС€РёР±РєСѓ TS2307 РїСЂРё Р»РѕРєР°Р»СЊРЅРѕРј Р·Р°РїСѓСЃРєРµ Р±РµР· РёР·РјРµРЅРµРЅРёСЏ СЂР°РЅС‚Р°Р№Рј-РїРѕРІРµРґРµРЅРёСЏ. РџРѕРІРµРґРµРЅРёРµ Р»РѕРіРёСЂРѕРІР°РЅРёСЏ Sentry РѕСЃС‚Р°Р»РѕСЃСЊ Р±РµР· РёР·РјРµРЅРµРЅРёР№.
 - **Mobile debug build РїСЂРѕРІРµСЂРµРЅ:** РІС‹РїРѕР»РЅРµРЅР° СЃР±РѕСЂРєР° `flutter build apk --debug` РґР»СЏ РјРѕР±РёР»СЊРЅРѕРіРѕ РєР»РёРµРЅС‚Р°, РєСЂРёС‚РёС‡РµСЃРєРёС… РѕС€РёР±РѕРє РЅРµС‚, APK СѓСЃРїРµС€РЅРѕ СЃРѕР±СЂР°РЅ; РїСЂРµРґСѓРїСЂРµР¶РґРµРЅРёСЏ РїРѕ РІРµСЂСЃРёРё Android Gradle Plugin Р·Р°С„РёРєСЃРёСЂРѕРІР°РЅС‹ РєР°Рє С‚РµС…РЅРёС‡РµСЃРєРёР№ РґРѕР»Рі Р±РµР· РёР·РјРµРЅРµРЅРёР№ РєРѕРЅС„РёРіСѓСЂР°С†РёРё РЅР° С‚РµРєСѓС‰РµРј skeleton-СЌС‚Р°РїРµ.

### 2026-01-29
- **Backend Firebase auth stub safety:** Р·Р°РіР»СѓС€РєР° РїСЂРѕРІРµСЂРєРё Firebase ID С‚РѕРєРµРЅРѕРІ РІ backend РїРѕРјРµС‡РµРЅР° РєР°Рє SECURITY STUB, РґРѕР±Р°РІР»РµРЅС‹ РїСЂРѕРІРµСЂРєРё `NODE_ENV` РІ `verifyToken`, Р° С‚Р°РєР¶Рµ startup-check `assertFirebaseAuthConfigured()` РїСЂРё Р·Р°РїСѓСЃРєРµ СЃРµСЂРІРµСЂР°; РІ production РѕРєСЂСѓР¶РµРЅРёРё РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ Р·Р°РіР»СѓС€РєРё С‚РµРїРµСЂСЊ РїСЂРёРІРѕРґРёС‚ Рє РЅРµРјРµРґР»РµРЅРЅРѕР№ РѕС€РёР±РєРµ, С‡С‚РѕР±С‹ РёСЃРєР»СЋС‡РёС‚СЊ СЃР»СѓС‡Р°Р№РЅС‹Р№ РґРµРїР»РѕР№ Р±РµР· СЂРµР°Р»СЊРЅРѕР№ РёРЅС‚РµРіСЂР°С†РёРё Firebase Admin SDK.
 - **Backend API auth middleware:** РґРѕР±Р°РІР»РµРЅРѕ РіР»РѕР±Р°Р»СЊРЅРѕРµ middleware Р°РІС‚РѕСЂРёР·Р°С†РёРё РґР»СЏ РІСЃРµС… `/api` СЂРѕСѓС‚РѕРІ, РєРѕС‚РѕСЂРѕРµ РѕР¶РёРґР°РµС‚ Р·Р°РіРѕР»РѕРІРѕРє `Authorization: Bearer <token>` Рё РїСЂРѕРєСЃРёСЂСѓРµС‚ РїСЂРѕРІРµСЂРєСѓ РІ `AuthService.verifyToken()` (FirebaseAuthService stub); РІ СЃР»СѓС‡Р°Рµ РѕС‚СЃСѓС‚СЃС‚РІРёСЏ РёР»Рё РЅРµРІР°Р»РёРґРЅРѕРіРѕ С‚РѕРєРµРЅР° СЌРЅРґРїРѕРёРЅС‚С‹ РІРѕР·РІСЂР°С‰Р°СЋС‚ `401 Unauthorized`. РџРѕРІРµРґРµРЅРёРµ РґРѕРјРµРЅРЅС‹С… Р·Р°РіР»СѓС€РµРє РЅРµ РёР·РјРµРЅРµРЅРѕ, РѕРіСЂР°РЅРёС‡РµРЅРёРµ РєР°СЃР°РµС‚СЃСЏ С‚РѕР»СЊРєРѕ РґРѕСЃС‚СѓРїР°.
 - **Backend runtime-РІР°Р»РёРґР°С†РёСЏ POST DTO:** РїРѕРґРєР»СЋС‡РµРЅР° С‚РµС…РЅРёС‡РµСЃРєР°СЏ runtime-РІР°Р»РёРґР°С†РёСЏ С‚РµР» Р·Р°РїСЂРѕСЃРѕРІ РґР»СЏ POST-СЌРЅРґРїРѕРёРЅС‚РѕРІ `activities`, `cities`, `clubs`, `events`, `runs`, `territories`, `users` СЃ РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµРј Zod-СЃС…РµРј РЅР° РѕСЃРЅРѕРІРµ СЃСѓС‰РµСЃС‚РІСѓСЋС‰РёС… `Create*Dto`. Р”РѕР±Р°РІР»РµРЅРѕ РѕР±С‰РµРµ middleware `validateBody(schema)`; РїСЂРё РЅРµСЃРѕРѕС‚РІРµС‚СЃС‚РІРёРё С„РѕСЂРјС‹/С‚РёРїРѕРІ РІС…РѕРґРЅС‹С… РґР°РЅРЅС‹С… backend РІРѕР·РІСЂР°С‰Р°РµС‚ `400 Bad Request`, Р±РёР·РЅРµСЃ-Р»РѕРіРёРєР° Рё РґРѕРјРµРЅРЅС‹Рµ РёРЅРІР°СЂРёР°РЅС‚С‹ РїРѕ-РїСЂРµР¶РЅРµРјСѓ РѕСЃС‚Р°СЋС‚СЃСЏ Р·Р°РіР»СѓС€РєР°РјРё.
 - **API РѕС€РёР±РєРё Рё РїРѕР»РёС‚РёРєР° РІР°Р»РёРґР°С†РёРё:** РІРІРµРґС‘РЅ РµРґРёРЅС‹Р№ РєРѕРЅРІРµСЂС‚ РѕС€РёР±РѕРє API `{ code; message; details? }`, СЃС‚Р°РЅРґР°СЂС‚РёР·РёСЂРѕРІР°РЅ С„РѕСЂРјР°С‚ РѕС€РёР±РѕРє РІР°Р»РёРґР°С†РёРё (`code: \"validation_error\"`, `details.fields[{ field; message; code }]`) РґР»СЏ Zod, Р° С‚Р°РєР¶Рµ С„РѕСЂРјР° РѕС‚РІРµС‚РѕРІ `401 Unauthorized` РІ `authMiddleware`; Р»РѕРєР°Р»РёР·Р°С†РёСЏ С‚РµРєСЃС‚РѕРІ РѕС€РёР±РѕРє РѕСЃС‚Р°С‘С‚СЃСЏ РЅР° СЃС‚РѕСЂРѕРЅРµ РєР»РёРµРЅС‚РѕРІ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [adr/0002-api-error-format-and-validation.md](adr/0002-api-error-format-and-validation.md), [docs/api-errors-and-validation.md](api-errors-and-validation.md).
 - **Mobile FutureBuilder state fix:** СЌРєСЂР°РЅС‹ РґРµС‚Р°Р»РµР№ (`ActivityDetailsScreen`, `CityDetailsScreen`, `ClubDetailsScreen`, `TerritoryDetailsScreen`, `EventDetailsScreen`) Рё РІРєР»Р°РґРєРё СЃРѕРѕР±С‰РµРЅРёР№ (`GlobalChatTab`, `ClubMessagesTab`, `NotificationsTab`) РїРµСЂРµРІРµРґРµРЅС‹ РЅР° `StatefulWidget` СЃ РєСЌС€РёСЂРѕРІР°РЅРЅС‹РјРё `Future` РІ `initState`, С‡С‚РѕР±С‹ РёР·Р±РµР¶Р°С‚СЊ РїРѕРІС‚РѕСЂРЅРѕРіРѕ РІС‹РїРѕР»РЅРµРЅРёСЏ HTTP-Р·Р°РїСЂРѕСЃРѕРІ Рё Р·Р°РіР»СѓС€РµРє РїСЂРё РєР°Р¶РґРѕРј `rebuild`; Р±РёР·РЅРµСЃ-Р»РѕРіРёРєР° Рё РґРѕРјРµРЅРЅС‹Рµ РёРЅРІР°СЂРёР°РЅС‚С‹ РЅРµ РёР·РјРµРЅРµРЅС‹.
 - **Mobile Maps territory radius fix:** СЂР°РґРёСѓСЃ placeholder-С‚РµСЂСЂРёС‚РѕСЂРёР№ РЅР° РєР°СЂС‚Рµ РїРµСЂРµСЃС‡РёС‚Р°РЅ РёР· С„РёРєСЃРёСЂРѕРІР°РЅРЅС‹С… РїРёРєСЃРµР»РµР№ РІ СЌРєСЂР°РЅРЅРѕ-Р·Р°РІРёСЃРёРјС‹Р№ СЂР°Р·РјРµСЂ РЅР° РѕСЃРЅРѕРІРµ zoom/С€РёСЂРѕС‚С‹, С‡С‚РѕР±С‹ РїСЂРёР±Р»РёР·РёС‚РµР»СЊРЅРѕ СЃРѕРѕС‚РІРµС‚СЃС‚РІРѕРІР°С‚СЊ 500 Рј РІ СЂРµР°Р»СЊРЅС‹С… РјРµС‚СЂР°С… Рё РјР°СЃС€С‚Р°Р±РёСЂРѕРІР°С‚СЊСЃСЏ РєРѕСЂСЂРµРєС‚РЅРѕ РїСЂРё Р·СѓРјРµ; РґРѕРјРµРЅРЅР°СЏ Р»РѕРіРёРєР° С‚РµСЂСЂРёС‚РѕСЂРёР№ РЅРµ РёР·РјРµРЅРµРЅР°, РїСЂР°РІРєР° Р·Р°С‚СЂР°РіРёРІР°РµС‚ С‚РѕР»СЊРєРѕ РІРёР·СѓР°Р»РёР·Р°С†РёСЋ РІ `MapScreen`.
 - **Mobile Run duration format fix:** РёСЃРїСЂР°РІР»РµРЅ Р±Р°Рі С„РѕСЂРјР°С‚РёСЂРѕРІР°РЅРёСЏ РґР»РёС‚РµР»СЊРЅРѕСЃС‚Рё РїСЂРѕР±РµР¶РєРё РІ `RunScreen`, РёР·-Р·Р° РєРѕС‚РѕСЂРѕРіРѕ РїСЂРѕР±РµР¶РєРё РґРѕР»СЊС€Рµ 60 РјРёРЅСѓС‚ РѕС‚РѕР±СЂР°Р¶Р°Р»РёСЃСЊ Р±РµР· С‡Р°СЃРѕРІ (РЅР°РїСЂРёРјРµСЂ, 1:30:00 РєР°Рє `30:00`); С‚РµРїРµСЂСЊ РїСЂРё РЅР°Р»РёС‡РёРё С‡Р°СЃРѕРІ РІСЂРµРјСЏ РїРѕРєР°Р·С‹РІР°РµС‚СЃСЏ РІ С„РѕСЂРјР°С‚Рµ `H:MM:SS`, РёРЅР°С‡Рµ `MM:SS`.
 - **Mobile Territories coordinates model dedup:** РґСѓР±Р»РёСЂСѓСЋС‰РёР№СЃСЏ РєР»Р°СЃСЃ `TerritoryCoordinates` РѕР±СЉРµРґРёРЅС‘РЅ РІ РѕРґРЅСѓ DTO-РјРѕРґРµР»СЊ РІ `territory_model.dart`, `territory_map_model.dart` С‚РµРїРµСЂСЊ РёСЃРїРѕР»СЊР·СѓРµС‚ РёРјРїРѕСЂС‚ РІРјРµСЃС‚Рѕ СЃРѕР±СЃС‚РІРµРЅРЅРѕР№ РєРѕРїРёРё; СЌС‚Рѕ СѓСЃС‚СЂР°РЅСЏРµС‚ РєРѕРЅС„Р»РёРєС‚ РёРјРµРЅ РїСЂРё СЃРѕРІРјРµСЃС‚РЅРѕРј РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРё РѕР±РµРёС… РјРѕРґРµР»РµР№ Р±РµР· РёР·РјРµРЅРµРЅРёСЏ СЃС‚СЂСѓРєС‚СѓСЂС‹ РґР°РЅРЅС‹С… РёР»Рё РґРѕРјРµРЅРЅРѕР№ Р»РѕРіРёРєРё.
 - **Logging refactor (local + dev remote logs):** Sentry РёРЅС‚РµРіСЂР°С†РёСЏ РІРѕ РІСЃРµС… РєРѕРјРїРѕРЅРµРЅС‚Р°С… РІСЂРµРјРµРЅРЅРѕ РѕС‚РєР»СЋС‡РµРЅР°; РЅР° backend РґРѕР±Р°РІР»РµРЅ РїСЂРѕСЃС‚РѕР№ СЃС‚СЂСѓРєС‚СѓСЂРёСЂРѕРІР°РЅРЅС‹Р№ Р»РѕРіРіРµСЂ Рё dev-only СЌРЅРґРїРѕРёРЅС‚ `POST /dev/log` РґР»СЏ РїСЂРёС‘РјР° СѓРґР°Р»С‘РЅРЅС‹С… Р»РѕРіРѕРІ РѕС‚ РјРѕР±РёР»СЊРЅРѕРіРѕ РїСЂРёР»РѕР¶РµРЅРёСЏ, РІ Flutter-РєР»РёРµРЅС‚Рµ `sentry_flutter` Р·Р°РјРµРЅС‘РЅ РЅР° Р»С‘РіРєРёР№ `DevRemoteLogger`, РєРѕС‚РѕСЂС‹Р№ РѕС‚РїСЂР°РІР»СЏРµС‚ С‚РµС…РЅРёС‡РµСЃРєРёРµ РѕС€РёР±РєРё РЅР° Р»РѕРєР°Р»СЊРЅС‹Р№ backend. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/logging.md](changes/logging.md), [adr/0003-local-logging-and-dev-remote-logs.md](adr/0003-local-logging-and-dev-remote-logs.md).
 - **Dev-Р»РѕРіРё РЅР° РµРґРёРЅС‹Р№ СѓРґР°Р»С‘РЅРЅС‹Р№ СЃРµСЂРІРµСЂ:** Р»РѕРіРё РІ dev РѕС‚РїСЂР°РІР»СЏСЋС‚СЃСЏ С‚РѕР»СЊРєРѕ РЅР° РІРЅРµС€РЅРёР№ Р»РѕРі-СЃРµСЂРІРµСЂ (POST /log, http://176.108.255.4:4000); РІ PROD РѕС‚РїСЂР°РІРєР° РѕС‚РєР»СЋС‡РµРЅР°. Backend: РјРѕРґСѓР»СЊ `devLogClient`, РїСЂРё error/warn вЂ” fire-and-forget POST РЅР° СЃРµСЂРІРµСЂ; СЌРЅРґРїРѕРёРЅС‚ `/dev/log` СѓРґР°Р»С‘РЅ. Mobile: `DevRemoteLogger` РѕС‚РїСЂР°РІР»СЏРµС‚ С‚РѕР»СЊРєРѕ РїСЂРё Р·Р°РґР°РЅРЅРѕРј `DEV_LOG_SERVER` (РІ prod РЅРµ Р·Р°РґР°С‘С‚СЃСЏ); РїСѓС‚СЊ `/log`. Admin: РґРѕР±Р°РІР»РµРЅР° СѓС‚РёР»РёС‚Р° `sendDevLog` РґР»СЏ Р±СѓРґСѓС‰РёС… РѕС€РёР±РѕРє API. Р•РґРёРЅР°СЏ С‚РѕС‡РєР° РїСЂРёС‘РјР° Р»РѕРіРѕРІ вЂ” СѓРґР°Р»С‘РЅРЅС‹Р№ СЃРµСЂРІРµСЂ; С‡СѓРІСЃС‚РІРёС‚РµР»СЊРЅС‹Рµ РґР°РЅРЅС‹Рµ РЅРµ Р»РѕРіРёСЂСѓСЋС‚СЃСЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/logging.md](changes/logging.md).
 - **Mobile Events RefreshIndicator fix:** РІ `EventsScreen` РјРµС‚РѕРґ `_refreshEvents()` РїРµСЂРµРІРµРґС‘РЅ РЅР° РІРѕР·РІСЂР°С‚ `Future<void>` СЃ РѕР¶РёРґР°РЅРёРµРј Р·Р°РІРµСЂС€РµРЅРёСЏ `_fetchEvents()`; `RefreshIndicator.onRefresh` РїРµСЂРµРґР°С‘С‚СЃСЏ РЅР°РїСЂСЏРјСѓСЋ `_refreshEvents`, С‡С‚РѕР±С‹ СЃРїРёРЅРЅРµСЂ pull-to-refresh РЅРµ РёСЃС‡РµР·Р°Р» РґРѕ РѕРєРѕРЅС‡Р°РЅРёСЏ Р·Р°РіСЂСѓР·РєРё. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md).
- **Mobile RunService baseUrl fix:** РІ `RunService` fallback РґР»СЏ `ApiClient` Р·Р°РјРµРЅС‘РЅ СЃ С…Р°СЂРґРєРѕРґР° `http://localhost:3000` РЅР° `ApiConfig.getBaseUrl()`, С‡С‚РѕР±С‹ submit РїСЂРѕР±РµР¶РєРё СЂР°Р±РѕС‚Р°Р» РЅР° Android-СЌРјСѓР»СЏС‚РѕСЂРµ (10.0.2.2). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **firebaseUid СѓС‚РµРєР°РµС‚ РІ API-РѕС‚РІРµС‚Р°С… (Р±РµР·РѕРїР°СЃРЅРѕСЃС‚СЊ):** РїРѕР»СЊР·РѕРІР°С‚РµР»СЊСЃРєРёРµ СЌРЅРґРїРѕРёРЅС‚С‹ `GET /api/users`, `GET /api/users/:id`, `POST /api/users` Р±РѕР»СЊС€Рµ РЅРµ РІРѕР·РІСЂР°С‰Р°СЋС‚ СЃСѓС‰РЅРѕСЃС‚СЊ User СЃ РїРѕР»РµРј firebaseUid; РІРІРµРґС‘РЅ РјР°РїРїРёРЅРі User в†’ UserViewDto (Р±РµР· firebaseUid) Рё С„СѓРЅРєС†РёСЏ `userToViewDto`. Р­РЅРґРїРѕРёРЅС‚ `GET /api/users/me/profile` СѓР¶Рµ РЅРµ СЂР°СЃРєСЂС‹РІР°Р» firebaseUid (ProfileDto.user вЂ” РѕС‚РґРµР»СЊРЅС‹Р№ РєРѕРЅС‚СЂР°РєС‚). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/users.md](changes/users.md).
 - **Р•РґРёРЅС‹Р№ DB pool (СѓСЃС‚СЂР°РЅРµРЅРёРµ РґСѓР±Р»РёСЂРѕРІР°РЅРёСЏ):** СѓРґР°Р»С‘РЅ РјРѕРґСѓР»СЊ `shared/db`; РѕСЃС‚Р°РІР»РµРЅ РµРґРёРЅСЃС‚РІРµРЅРЅС‹Р№ РёСЃС‚РѕС‡РЅРёРє РїСѓР»Р° PostgreSQL вЂ” `db/client.ts`. РЈСЃС‚СЂР°РЅРµРЅС‹ РґРІР° РїР°СЂР°Р»Р»РµР»СЊРЅС‹С… РїСѓР»Р° СЃ РєРѕР»Р»РёР·РёРµР№ `getDbPool()` Рё СѓРґРІРѕРµРЅРёРµРј СЃРѕРµРґРёРЅРµРЅРёР№ РїСЂРё РёРјРїРѕСЂС‚Рµ РѕР±РѕРёС…. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/database.md](changes/database.md).
 - **Backend graceful shutdown (DB pool):** РІ `server.ts` РґРѕР±Р°РІР»РµРЅ С‚РµС…РЅРёС‡РµСЃРєРёР№ РѕР±СЂР°Р±РѕС‚С‡РёРє СЃРёРіРЅР°Р»РѕРІ `SIGTERM`/`SIGINT`, РєРѕС‚РѕСЂС‹Р№ РїСЂРё Р·Р°РІРµСЂС€РµРЅРёРё РїСЂРѕС†РµСЃСЃР° РІС‹Р·С‹РІР°РµС‚ `closeDbPool()` РёР· `db/client.ts` Рё Р»РѕРіРёСЂСѓРµС‚ СЂРµР·СѓР»СЊС‚Р°С‚ С‡РµСЂРµР· `logger`; С†РµР»СЊ вЂ” РєРѕСЂСЂРµРєС‚РЅРѕ Р·Р°РєСЂС‹РІР°С‚СЊ РїСѓР» PostgreSQL Рё РЅРµ РѕСЃС‚Р°РІР»СЏС‚СЊ РІРёСЃСЏС‰РёРµ СЃРѕРµРґРёРЅРµРЅРёСЏ РїСЂРё РѕСЃС‚Р°РЅРѕРІРєРµ backend-СЃРµСЂРІРµСЂР°. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/database.md](changes/database.md).
 - **DB_PASSWORD РІ production (Р±РµР·РѕРїР°СЃРЅРѕСЃС‚СЊ):** РІ production РѕРєСЂСѓР¶РµРЅРёРё Р·Р°РїСѓСЃРє backend Р±РµР· Р·Р°РґР°РЅРЅРѕРіРѕ `DB_PASSWORD` РїСЂРёРІРѕРґРёС‚ Рє РІС‹Р±СЂРѕСЃСѓ РѕС€РёР±РєРё РІ `getDbConfig()` (config/db.ts); РґРµС„РѕР»С‚ РїСѓСЃС‚РѕР№ СЃС‚СЂРѕРєРё СЃРѕС…СЂР°РЅС‘РЅ С‚РѕР»СЊРєРѕ РґР»СЏ РЅРµ-production. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/database.md](changes/database.md).
- **Invalid Date РїСЂРё СЃРѕР·РґР°РЅРёРё run (Р±Р°Рі):** РІ `CreateRunSchema` РїРѕР»СЏ `startedAt` Рё `endedAt` Р·Р°РјРµРЅРµРЅС‹ СЃ `z.string()` РЅР° `z.string().datetime()`, С‡С‚РѕР±С‹ РЅРµРІР°Р»РёРґРЅС‹Рµ ISO-СЃС‚СЂРѕРєРё РѕС‚РєР»РѕРЅСЏР»РёСЃСЊ РґРѕ РїР°СЂСЃРёРЅРіР°; РїСЂРё РЅРµРєРѕСЂСЂРµРєС‚РЅРѕРј С„РѕСЂРјР°С‚Рµ РґР°С‚С‹ backend РІРѕР·РІСЂР°С‰Р°РµС‚ `400` СЃ validation_error РІРјРµСЃС‚Рѕ СЃРµСЂРёР°Р»РёР·Р°С†РёРё Invalid Date РІ null. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Mobile API auth (Р±РµР·РѕРїР°СЃРЅРѕСЃС‚СЊ):** РІ `ApiClient` РґРѕР±Р°РІР»РµРЅР° РїРѕРґРґРµСЂР¶РєР° РѕРїС†РёРѕРЅР°Р»СЊРЅРѕРіРѕ `authToken` Рё Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєР°СЏ РїРѕРґСЃС‚Р°РЅРѕРІРєР° Р·Р°РіРѕР»РѕРІРєР° `Authorization: Bearer <token>` РІРѕ РІСЃРµ GET Рё POST Р·Р°РїСЂРѕСЃС‹; РјРµС…Р°РЅРёР·Рј РёРЅСЉРµРєС†РёРё С‚РѕРєРµРЅР° РіРѕС‚РѕРІ, РїРµСЂРµРґР°С‡Р° С‚РѕРєРµРЅР° РїСЂРё СЃРѕР·РґР°РЅРёРё РєР»РёРµРЅС‚Р° вЂ” РѕС‚РІРµС‚СЃС‚РІРµРЅРЅРѕСЃС‚СЊ РІС‹Р·С‹РІР°СЋС‰РµРіРѕ РєРѕРґР° (РЅР°РїСЂРёРјРµСЂ Firebase ID token). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/api-client.md](changes/api-client.md).
- **Mobile API base URL вЂ” HTTPS РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ (Р±РµР·РѕРїР°СЃРЅРѕСЃС‚СЊ):** РІ `api_config.dart` РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ СЃС…РµРјР° https РґР»СЏ base URL; РґР»СЏ dev/emulator РјРѕР¶РЅРѕ РѕСЃС‚Р°РІРёС‚СЊ http С‡РµСЂРµР· `--dart-define=API_BASE_URL=http://10.0.2.2:3000` (РёР»Рё http://localhost:3000). Р’ production РЅРµ РїРµСЂРµРґР°РІР°С‚СЊ API_BASE_URL вЂ” С‚РѕРіРґР° РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ https СЃ РїР»Р°С‚С„РѕСЂРјРµРЅРЅС‹Рј С…РѕСЃС‚РѕРј. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/api-client.md](changes/api-client.md).
- **Mobile ApiClient вЂ” СЃРёРЅРіР»С‚РѕРЅ Рё dispose (СѓС‚РµС‡РєР° СЂРµСЃСѓСЂСЃРѕРІ):** `ApiClient` СЃРѕР·РґР°РІР°Р» РЅРѕРІС‹Р№ `http.Client()` РЅР° РєР°Р¶РґС‹Р№ СЌРєСЂР°РЅ Р±РµР· РІС‹Р·РѕРІР° `close()`, СЃРѕРєРµС‚С‹ РЅРµ Р·Р°РєСЂС‹РІР°Р»РёСЃСЊ. Р’РІРµРґС‘РЅ СЃРёРЅРіР»С‚РѕРЅ С‡РµСЂРµР· `ApiClient.getInstance(baseUrl:, authToken?)` вЂ” РѕРґРёРЅ СЌРєР·РµРјРїР»СЏСЂ РЅР° РїСЂРёР»РѕР¶РµРЅРёРµ, РѕРґРёРЅ `http.Client`. Р”РѕР±Р°РІР»РµРЅ РјРµС‚РѕРґ `dispose()` РґР»СЏ Р·Р°РєСЂС‹С‚РёСЏ РєР»РёРµРЅС‚Р° Рё СЃР±СЂРѕСЃР° СЃРёРЅРіР»С‚РѕРЅР° (С‚РµСЃС‚С‹, СЏРІРЅС‹Р№ logout). Р’СЃРµ СЌРєСЂР°РЅС‹ Рё СЃРµСЂРІРёСЃС‹ РїРµСЂРµРІРµРґРµРЅС‹ РЅР° `getInstance()`. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/api-client.md](changes/api-client.md).
- **Mobile ServiceLocator (DI):** РІРЅРµРґСЂС‘РЅ РїСЂРѕСЃС‚РѕР№ ServiceLocator: ApiClient Рё РІСЃРµ API-СЃРµСЂРІРёСЃС‹ СЃРѕР·РґР°СЋС‚СЃСЏ РѕРґРёРЅ СЂР°Р· РІ `ServiceLocator.init()` РїСЂРё СЃС‚Р°СЂС‚Рµ РїСЂРёР»РѕР¶РµРЅРёСЏ (РІ `main.dart`). Р­РєСЂР°РЅС‹ Рё РІРєР»Р°РґРєРё РїРѕР»СѓС‡Р°СЋС‚ СЃРµСЂРІРёСЃС‹ С‡РµСЂРµР· `ServiceLocator.eventsService`, `ServiceLocator.mapService` Рё С‚.Рґ.; РґСѓР±Р»РёСЂРѕРІР°РЅРёРµ С†РµРїРѕС‡РєРё getBaseUrl в†’ getInstance в†’ new XxxService СѓСЃС‚СЂР°РЅРµРЅРѕ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/api-client.md](changes/api-client.md), [adr/0004-mobile-service-locator-di.md](adr/0004-mobile-service-locator-di.md).
- **Mobile LocationService dispose (СѓС‚РµС‡РєР° РїР°РјСЏС‚Рё):** РІ `RunService` РїСЂРё СЃРѕР·РґР°РЅРёРё Р±РµР· РёРЅР¶РµРєС†РёРё `LocationService` СЃРѕР·РґР°РІР°Р»СЃСЏ РЅРѕРІС‹Р№ СЌРєР·РµРјРїР»СЏСЂ СЃ `StreamController`, РєРѕС‚РѕСЂС‹Р№ РЅРёРєРѕРіРґР° РЅРµ РѕСЃРІРѕР±РѕР¶РґР°Р»СЃСЏ. Р”РѕР±Р°РІР»РµРЅ С„Р»Р°Рі РІР»Р°РґРµРЅРёСЏ `_ownLocationService`; РІ `cancelRun()` РїСЂРё РІР»Р°РґРµРЅРёРё РІС‹Р·С‹РІР°РµС‚СЃСЏ `_locationService.dispose()` Рё СЃРѕР·РґР°С‘С‚СЃСЏ РЅРѕРІС‹Р№ СЌРєР·РµРјРїР»СЏСЂ РґР»СЏ СЃР»РµРґСѓСЋС‰РµРіРѕ `startRun()`. Р”РѕР±Р°РІР»РµРЅ РјРµС‚РѕРґ `dispose()` РґР»СЏ РѕСЃРІРѕР±РѕР¶РґРµРЅРёСЏ РїСЂРё СѓРЅРёС‡С‚РѕР¶РµРЅРёРё RunService (РЅР°РїСЂРёРјРµСЂ РІ С‚РµСЃС‚Р°С…). Р’ `ProfileScreen` LocationService РЅРµ СЃРѕР·РґР°С‘С‚СЃСЏ вЂ” РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ СЃРёРЅРіР»С‚РѕРЅ РёР· ServiceLocator, РІС‹Р·РѕРІ dispose С‚Р°Рј РЅРµ С‚СЂРµР±СѓРµС‚СЃСЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Mobile RunModel (DTO) vs RunSession (UI state):** RunSession вЂ” РјРѕРґРµР»СЊ СЃРѕСЃС‚РѕСЏРЅРёСЏ С‚СЂРµРєРµСЂР° (idle/recording/result), Р±РµР· fromJson/toJson, Р±РµР· userId/endedAt/createdAt; duration вЂ” Duration, СЃС‚Р°С‚СѓСЃ вЂ” RunSessionStatus (running, completed). РЎРѕР·РґР°РЅР° РѕС‚РґРµР»СЊРЅР°СЏ DTO `RunModel` РґР»СЏ РґРµСЃРµСЂРёР°Р»РёР·Р°С†РёРё backend RunViewDto: id, userId, activityId?, startedAt, endedAt, duration (СЃРµРєСѓРЅРґС‹ в†’ Duration), distance, status (RunModelStatus: completed, invalid), createdAt, updatedAt. RunService.submitRun РїР°СЂСЃРёС‚ РѕС‚РІРµС‚ 201 С‡РµСЂРµР· RunModel.fromJson РґР»СЏ СЃРѕРіР»Р°СЃРѕРІР°РЅРЅРѕСЃС‚Рё СЃ РєРѕРЅС‚СЂР°РєС‚РѕРј backend. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/runs.md](changes/runs.md).
- **Mobile API error handling (activities, cities, clubs, territories):** РІ СЃРµСЂРІРёСЃР°С… `ActivitiesService`, `CitiesService`, `ClubsService`, `TerritoriesService` РґРѕР±Р°РІР»РµРЅР° РїСЂРѕРІРµСЂРєР° `response.statusCode` Рё РѕР±СЂР°Р±РѕС‚РєР° РЅРµ-JSON РѕС‚РІРµС‚РѕРІ РїРѕ РѕР±СЂР°Р·С†Сѓ `EventsService.getEvents()`: РїСЂРё СЃС‚Р°С‚СѓСЃРµ != 200 РІС‹Р±СЂР°СЃС‹РІР°РµС‚СЃСЏ `Exception`, РїСЂРё РѕС‚РІРµС‚Рµ РЅРµ application/json РёР»Рё HTML вЂ” `FormatException` СЃ РїРѕРЅСЏС‚РЅС‹Рј СЃРѕРѕР±С‰РµРЅРёРµРј; РїР°СЂСЃРёРЅРі JSON РѕР±С‘СЂРЅСѓС‚ РІ try/catch. Р­С‚Рѕ СѓСЃС‚СЂР°РЅСЏРµС‚ FormatException РїСЂРё 404/500 Рё РѕС‚РІРµС‚Р°С… СЃ HTML. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/activities.md](changes/activities.md), [changes/cities.md](changes/cities.md), [changes/clubs.md](changes/clubs.md), [changes/territories.md](changes/territories.md).
- **Backend: РµРґРёРЅС‹Р№ РёСЃС‚РѕС‡РЅРёРє РєРѕРЅС„РёРіСѓСЂР°С†РёРё Р‘Р”:** РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ Р‘Р” Р±РѕР»СЊС€Рµ РЅРµ РґСѓР±Р»РёСЂСѓРµС‚СЃСЏ РІ env.ts; РµРґРёРЅСЃС‚РІРµРЅРЅС‹Р№ РёСЃС‚РѕС‡РЅРёРє вЂ” `config/db.ts`. EnvConfig СЃРѕРґРµСЂР¶РёС‚ С‚РѕР»СЊРєРѕ `port`; РґРѕР±Р°РІР»РµРЅР° РїСЂРѕРІРµСЂРєР° parseInt РЅР° NaN РґР»СЏ PORT Рё DB_PORT; Р·Р°РіСЂСѓР·РєР° .env РІС‹РЅРµСЃРµРЅР° РІ СЏРІРЅС‹Р№ `loadEnv()` РІ server.ts. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/database.md](changes/database.md).
- **Backend: РµРґРёРЅР°СЏ auth-Р°Р±СЃС‚СЂР°РєС†РёСЏ:** СѓРґР°Р»РµРЅР° РґСѓР±Р»РёСЂСѓСЋС‰Р°СЏ Р°Р±СЃС‚СЂР°РєС†РёСЏ auth/service (AuthService, FirebaseAuthService); middleware Рё РєРѕРґ РёСЃРїРѕР»СЊР·СѓСЋС‚ С‚РѕР»СЊРєРѕ `modules/auth` (AuthProvider, FirebaseAuthProvider, getAuthProvider()). РЈРґР°Р»С‘РЅ auth/service.ts; auth/types СЂРµСЌРєСЃРїРѕСЂС‚РёСЂСѓРµС‚ С‚РёРїС‹ РёР· modules/auth. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/auth.md](changes/auth.md).
- **Backend: РѕР±С‰РёР№ С‚РёРї РєРѕРѕСЂРґРёРЅР°С‚ (latitude, longitude):** РІРІРµРґС‘РЅ shared С‚РёРї `GeoCoordinates` РІ `shared/types/coordinates.ts`; city, territory, event, run, map РёСЃРїРѕР»СЊР·СѓСЋС‚ РµРіРѕ (CityCoordinates, TerritoryCoordinates, EventStartLocation, GpsPoint extends GeoCoordinates, MapCoordinates вЂ” Р°Р»РёР°СЃС‹). РЈСЃС‚СЂР°РЅРµРЅРѕ РґСѓР±Р»РёСЂРѕРІР°РЅРёРµ РІ 5 РјРѕРґСѓР»СЏС…. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/backend-coordinates.md](changes/backend-coordinates.md).
- **Backend: CORS, rate limiting, express.json limit:** РґРѕР±Р°РІР»РµРЅС‹ CORS middleware, rate limit 100 req/min per IP РґР»СЏ /api (product_spec 18.1), СЏРІРЅС‹Р№ limit РґР»СЏ express.json (1mb). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/backend-security.md](changes/backend-security.md).
- **Backend: env вЂ” loadEnv Рё parseInt NaN:** РІ env.ts РґРѕР±Р°РІР»РµРЅР° С„СѓРЅРєС†РёСЏ `loadEnv()` РґР»СЏ СЏРІРЅРѕР№ Р·Р°РіСЂСѓР·РєРё .env (РІС‹Р·РѕРІ РёР· server.ts); РїР°СЂСЃРёРЅРі PORT Рё DB_PORT СЃ РїСЂРѕРІРµСЂРєРѕР№ РЅР° NaN Рё РґРѕРїСѓСЃС‚РёРјС‹Р№ РґРёР°РїР°Р·РѕРЅ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/database.md](changes/database.md).
- **Mobile: GoRouter refreshListenable:** СЃС‚Р°С‚РёС‡РµСЃРєРёР№ GoRouter РґРѕРїРѕР»РЅРµРЅ `refreshListenable: authRefreshNotifier`; РїСЂРё РІС‹Р·РѕРІРµ `authRefreshNotifier.refresh()` РјР°СЂС€СЂСѓС‚РёР·Р°С‚РѕСЂ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ (Р·Р°РґРµР» РїРѕРґ СЂРµР°РєС†РёСЋ РЅР° СЃРјРµРЅСѓ auth). РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/mobile-app.md](changes/mobile-app.md).
- **Mobile: EventsScreen вЂ” С„РёР»СЊС‚СЂС‹ РїРµСЂРµР·Р°РїСЂР°С€РёРІР°СЋС‚ РґР°РЅРЅС‹Рµ:** РїСЂРё СЃРјРµРЅРµ С„РёР»СЊС‚СЂР° РїРѕ РґР°С‚Рµ РёР»Рё В«РўРѕР»СЊРєРѕ РѕС‚РєСЂС‹С‚С‹РµВ» РІС‹Р·С‹РІР°РµС‚СЃСЏ `_eventsFuture = _fetchEvents()` Рё СЃРїРёСЃРѕРє СЃРѕР±С‹С‚РёР№ РїРµСЂРµР·Р°РіСЂСѓР¶Р°РµС‚СЃСЏ. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/events.md](changes/events.md).
- **Open features вЂ” СѓС‡Р°СЃС‚РёРµ РІ Р°РєС‚РёРІРЅРѕСЃС‚СЏС… Рё С„РёР»СЊС‚СЂ В«РњРѕР№ РєР»СѓР±В» (РґРѕРєСѓРјРµРЅС‚Р°С†РёСЏ СЃРѕСЃС‚РѕСЏРЅРёСЏ):** Р—Р°С„РёРєСЃРёСЂРѕРІР°РЅРѕ С‚РµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ РѕС‚РєСЂС‹С‚С‹С… С„РёС‡ РёР· СЂР°Р·РґРµР»Р° `### РћС‚РєСЂС‹С‚С‹Рµ С„РёС‡Рё` РІ `infra/README.md`: (1) СѓС‡Р°СЃС‚РёРµ РІ СЃРѕР±С‹С‚РёСЏС… (join/check-in) СЂРµР°Р»РёР·РѕРІР°РЅРѕ С‡Р°СЃС‚РёС‡РЅРѕ вЂ” backend-СЌРЅРґРїРѕРёРЅС‚С‹ `POST /api/events/:id/join` Рё `POST /api/events/:id/check-in` СЂР°Р±РѕС‚Р°СЋС‚ С‡РµСЂРµР· СЂРµРїРѕР·РёС‚РѕСЂРёР№ Рё mock-`userId`, РЅРѕ С‚СЂРµР±СѓСЋС‚ РїСЂРёРІСЏР·РєРё Рє auth, СЏРІРЅРѕР№ РјРѕРґРµР»Рё СѓС‡Р°СЃС‚РЅРёРєРѕРІ Рё РїСЂРёРІРµРґРµРЅРёСЏ Рє С„РѕСЂРјР°С‚Сѓ РѕС€РёР±РѕРє ADR-0002; РјРµС‚РѕРґС‹ `EventsService.joinEvent/checkInEvent` Рё РєРЅРѕРїРєР° В«РџСЂРёСЃРѕРµРґРёРЅРёС‚СЊСЃСЏВ» РІ РјРѕР±РёР»СЊРЅРѕРј UI РѕСЃС‚Р°СЋС‚СЃСЏ TODO. (2) СѓС‡Р°СЃС‚РёРµ РІ РєР»СѓР±Р°С… (join club) РЅР° backend РѕРіСЂР°РЅРёС‡РµРЅРѕ mock-СЂРѕСѓС‚РµСЂРѕРј `clubs.routes.ts` Р±РµР· API С‡Р»РµРЅСЃС‚РІР°; РЅР° РјРѕР±РёР»СЊРЅРѕРј РєР»РёРµРЅС‚Рµ РѕС‚СЃСѓС‚СЃС‚РІСѓРµС‚ РјРµС‚РѕРґ `joinClub` Рё РєРЅРѕРїРєР° РїСЂРёСЃРѕРµРґРёРЅРµРЅРёСЏ РЅР° `ClubDetailsScreen`. (3) С„РёР»СЊС‚СЂ В«РњРѕР№ РєР»СѓР±В» РѕРїРёСЂР°РµС‚СЃСЏ РЅР° СѓР¶Рµ СЂРµР°Р»РёР·РѕРІР°РЅРЅСѓСЋ РїРѕРґРґРµСЂР¶РєСѓ `clubId` РІ `GET /api/events` Рё `GET /api/map/data`, РЅРѕ РЅР° mobile РїРѕРєР° С…СЂР°РЅРёС‚СЃСЏ С‚РѕР»СЊРєРѕ РєР°Рє placeholder РІ `MapFilters`/`MapFiltersPanel` Рё РЅРµ СЃРІСЏР·Р°РЅ СЃ СЂРµР°Р»СЊРЅС‹Рј В«РјРѕРёРј РєР»СѓР±РѕРјВ» РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ; РІ `EventsScreen` РµСЃС‚СЊ Р·Р°РґРµР» РїРѕРґ С„РёР»СЊС‚СЂ РїРѕ РєР»СѓР±Сѓ, РЅРѕ СЃР°Рј РІС‹Р±РѕСЂ РєР»СѓР±Р° Рё РїРѕРЅСЏС‚РёРµ primary club РЅРµ СЂРµР°Р»РёР·РѕРІР°РЅС‹. РўРµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ Рё next steps РїРѕРґСЂРѕР±РЅРѕ РѕРїРёСЃР°РЅС‹ РІ [infra/README.md](../infra/README.md), СЃСЃС‹Р»РєРё РЅР° СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‰РёРµ РёР·РјРµРЅРµРЅРёСЏ вЂ” [changes/events.md](changes/events.md), [changes/clubs.md](changes/clubs.md), [changes/maps.md](changes/maps.md).
- **Docs: infra/README.md вЂ” СЂР°Р·РґРµР» В«РћС‚РєСЂС‹С‚С‹Рµ С„РёС‡РёВ»:** РЈС‚РѕС‡РЅРµРЅРѕ РѕРїРёСЃР°РЅРёРµ РѕС‚РІРµС‚Р° `POST /api/events/:id/join` (РїРµСЂРµС‡РёСЃР»РµРЅС‹ РїРѕР»СЏ `{ success, error?, eventId, participant? }` РїРѕ С„Р°РєС‚РёС‡РµСЃРєРѕР№ СЂРµР°Р»РёР·Р°С†РёРё) Рё РёСЃРїСЂР°РІР»РµРЅС‹ РѕС‚РЅРѕСЃРёС‚РµР»СЊРЅС‹Рµ СЃСЃС‹Р»РєРё РЅР° РїСЂРѕРґСѓРєС‚РѕРІСѓСЋ СЃРїРµС†РёС„РёРєР°С†РёСЋ Рё С„Р°Р№Р»С‹ `docs/changes/*` С‚Р°Рє, С‡С‚РѕР±С‹ РѕРЅРё РєРѕСЂСЂРµРєС‚РЅРѕ СЂР°Р·СЂРµС€Р°Р»РёСЃСЊ РёР· РґРёСЂРµРєС‚РѕСЂРёРё `infra/`. РџРѕРІРµРґРµРЅРёРµ backend Рё mobile РЅРµ РёР·РјРµРЅРёР»РѕСЃСЊ, РѕР±РЅРѕРІР»РµРЅР° С‚РѕР»СЊРєРѕ РґРѕРєСѓРјРµРЅС‚Р°С†РёСЏ.
- **Mobile: РёСЃРїСЂР°РІР»РµРЅРёРµ СЃСЂРµРґРЅРёС… РїСЂРѕР±Р»РµРј (36-50):** РёСЃРїСЂР°РІР»РµРЅС‹ РїСЂРѕР±Р»РµРјС‹ РЅР°РІРёРіР°С†РёРё (context.go в†’ context.push РґР»СЏ СЃРѕС…СЂР°РЅРµРЅРёСЏ back stack), РѕРїС‚РёРјРёР·РёСЂРѕРІР°РЅ O(nВІ) РїРµСЂРµСЃС‡С‘С‚ РґРёСЃС‚Р°РЅС†РёРё РІ RunScreen, СЃРёРЅС…СЂРѕРЅРёР·РёСЂРѕРІР°РЅС‹ _onMapCreated Рё _loadMapData РІ MapScreen, РёСЃРїСЂР°РІР»РµРЅР° РѕР±СЂР°Р±РѕС‚РєР° РѕС€РёР±РѕРє GPS permissions, СѓР±СЂР°РЅС‹ С…Р°СЂРґРєРѕРґС‹, РІС‹РЅРµСЃРµРЅР° РѕР±С‰Р°СЏ РѕР±СЂР°Р±РѕС‚РєР° РѕС€РёР±РѕРє РІ ErrorDisplay РІРёРґР¶РµС‚, РґРѕР±Р°РІР»РµРЅ РїР°СЂСЃРёРЅРі clubId РІ TerritoryModel, РёСЃРїСЂР°РІР»РµРЅС‹ unsafe as int casts РІРѕ РІСЃРµС… РјРѕРґРµР»СЏС…, РёСЃРїСЂР°РІР»РµРЅ api_config.dart РґР»СЏ СЃРѕРІРјРµСЃС‚РёРјРѕСЃС‚Рё СЃ Flutter Web. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/mobile-fixes.md](changes/mobile-fixes.md).
- **Backend: РёСЃРїСЂР°РІР»РµРЅРёРµ РЅРёР·РєРёС… РїСЂРѕР±Р»РµРј (L-1вЂ“L-10):** РёСЃРїСЂР°РІР»РµРЅС‹ С‚РµС…РЅРёС‡РµСЃРєРёРµ РїСЂРѕР±Р»РµРјС‹ РєРѕРґР°: РїСЂРµС„РёРєСЃ _ РґР»СЏ РЅРµРёСЃРїРѕР»СЊР·СѓРµРјС‹С… РїР°СЂР°РјРµС‚СЂРѕРІ РІ error handler, Р°РґСЂРµСЃ РїСЂРѕСЃР»СѓС€РёРІР°РЅРёСЏ СЃРµСЂРІРµСЂР° Р·Р°РІРёСЃРёС‚ РѕС‚ РѕРєСЂСѓР¶РµРЅРёСЏ (0.0.0.0 С‚РѕР»СЊРєРѕ РІ dev), РґРѕР±Р°РІР»РµРЅРѕ РїСЂРёРІРµРґРµРЅРёРµ С‚РёРїРѕРІ РґР»СЏ req.query РІ events/map routes, СЂРѕСѓС‚РµСЂС‹ РїРµСЂРµРІРµРґРµРЅС‹ РЅР° barrel exports РјРѕРґСѓР»РµР№, РёРЅС‚РµСЂС„РµР№СЃ Notification РїРµСЂРµРёРјРµРЅРѕРІР°РЅ РІ UserNotification РґР»СЏ РёР·Р±РµР¶Р°РЅРёСЏ РєРѕРЅС„Р»РёРєС‚Р° СЃ Web API, РёСЃРїСЂР°РІР»РµРЅ РґСѓР±Р»РёСЂСѓСЋС‰РёР№СЃСЏ re-export РІ auth barrel, РїРµСЂРµРёРјРµРЅРѕРІР°РЅРѕ РїРѕР»Рµ isMercantile в†’ isMercenary РІРѕ РІСЃРµС… С„Р°Р№Р»Р°С…. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/backend-low-issues.md](changes/backend-low-issues.md).
- **Mobile: РёСЃРїСЂР°РІР»РµРЅРёРµ РЅРёР·РєРёС… РїСЂРѕР±Р»РµРј (L-11вЂ“L-27):** РёСЃРїСЂР°РІР»РµРЅС‹ С‚РµС…РЅРёС‡РµСЃРєРёРµ РїСЂРѕР±Р»РµРјС‹ РєРѕРґР°: СѓР±СЂР°РЅС‹ Р±РµСЃРїРѕР»РµР·РЅС‹Рµ try/catch СЃ rethrow РІ ApiClient, Р·Р°РјРµРЅРµРЅС‹ deprecated withOpacity() РЅР° Color.fromRGBO, РёСЃРїСЂР°РІР»РµРЅР° РёРјРјСѓС‚Р°Р±РµР»СЊРЅРѕСЃС‚СЊ RunSession.gpsPoints, РґРѕР±Р°РІР»РµРЅС‹ TODO РєРѕРјРјРµРЅС‚Р°СЂРёРё РґР»СЏ i18n/Equatable/retry, РёСЃРїСЂР°РІР»РµРЅС‹ С„РёР»СЊС‚СЂС‹ СЃРѕР±С‹С‚РёР№ (РѕС‚РїСЂР°РІРєР° query РїР°СЂР°РјРµС‚СЂРѕРІ), Р·Р°РјРµРЅРµРЅРѕ СЂСѓС‡РЅРѕРµ С„РѕСЂРјР°С‚РёСЂРѕРІР°РЅРёРµ РґР°С‚ РЅР° DateFormat, РІС‹РЅРµСЃРµРЅ РѕР±С‰РёР№ РІРёРґР¶РµС‚ NotificationItem РґР»СЏ СѓСЃС‚СЂР°РЅРµРЅРёСЏ РґСѓР±Р»РёСЂРѕРІР°РЅРёСЏ, РґРѕР±Р°РІР»РµРЅ copyWith РґР»СЏ MapFilters, СѓРґР°Р»С‘РЅ РЅРµРёСЃРїРѕР»СЊР·СѓРµРјС‹Р№ РјРµС‚РѕРґ _showEventCard. РџРѕРґСЂРѕР±РЅРѕСЃС‚Рё вЂ” [changes/mobile-low-issues-l11-l27.md](changes/mobile-low-issues-l11-l27.md).


