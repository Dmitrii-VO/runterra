# Прогресс разработки — 2026-02-08

## Исправления по Feedback (2026-02-06)

Закрыты три критические проблемы из раздела Feedback (2026-02-06) в infra/README.md:

### 1. Пробежка — позиция и темп

**Проблема:**
- При старте пробежки не отображалась текущая позиция на карте
- Отсутствовала кнопка «Найти себя» для центрирования карты
- Темп считался некорректно до стабилизации GPS

**Решение:**
- Добавлен CircleMapObject для отображения текущей позиции при 1+ GPS-точках
- Добавлена FAB кнопка «Найти себя» для центрирования карты на текущей позиции
- Увеличен порог отображения темпа с 10м до 50м для стабилизации GPS
- Добавлено отображение текущего темпа во время пробежки

**Файлы:**
- mobile/lib/features/run/widgets/run_route_map.dart
- mobile/lib/features/run/run_screen.dart
- mobile/l10n/app_ru.arb, app_en.arb

### 2. Клубы — реальное создание

**Проблема:**
- POST /api/clubs и GET /api/clubs/:id возвращали моки
- Создатель клуба не добавлялся в участники автоматически
- Название и описание клуба не сохранялись

**Решение:**
- Создана миграция 010_clubs.sql с таблицей clubs (id UUID, name, description, status, city_id, creator_id, timestamps)
- Реализован ClubsRepository с методами findById, findByCityId, create, update, delete
- Обновлены POST /api/clubs и GET /api/clubs/:id для работы с БД вместо моков
- При создании клуба создатель автоматически добавляется в club_members со статусом active

**Файлы:**
- backend/src/db/migrations/010_clubs.sql
- backend/src/db/repositories/clubs.repository.ts
- backend/src/modules/clubs/club.entity.ts
- backend/src/api/clubs.routes.ts

### 3. События — time-based completed

**Проблема:**
- Прошедшие события отображались со статусом «Открыто»
- В модели событий отсутствовало поле endDateTime
- Статус обновлялся только по лимиту участников

**Решение:**
- Добавлена миграция 011_events_end_date_time.sql с полем end_date_time
- Обновлены Event entity, DTO и EventsRepository для поддержки endDateTime
- Реализована функция computeEventStatus для автоматического перехода в COMPLETED если endDateTime прошло
- Приоритет статусов: CANCELLED/COMPLETED из БД сохраняются → endDateTime < now → COMPLETED → participantCount >= participantLimit → FULL → иначе статус из БД

**Файлы:**
- backend/src/db/migrations/011_events_end_date_time.sql
- backend/src/modules/events/event.entity.ts
- backend/src/modules/events/event.dto.ts
- backend/src/db/repositories/events.repository.ts

## Детали

Подробности — [changes/2026-02-08-feedback-fixes.md](changes/2026-02-08-feedback-fixes.md)
